# 季度轮动ETF池实验结果报告

**实验日期**: 2025-12-08 (v2版本)
**实验目的**: 验证季度更新ETF池能否提升回测收益和夏普比率

---

## 版本说明

| 版本 | 日期 | 核心改进 |
|------|------|----------|
| **v2 (当前)** | 2025-12-08 | 分季度独立回测，避免前视偏差，计算等权组合净值 |
| v1 (已废弃) | 2025-12-07 | 存在前视偏差，指标计算方法有误 |

**v1版本问题**:
1. **前视偏差**: 轮动组使用119只ETF的并集做一次性回测，导致未来季度的ETF可以在早期季度交易
2. **指标计算错误**: 仅计算ETF横截面平均，未计算时间序列组合净值

---

## 一、实验设计 (v2)

### 1.1 季度调仓机制

**关键设计**: v2采用**分季度独立回测 + 净值拼接**的方法，而非模拟实际调仓交易。

| 步骤 | 说明 |
|------|------|
| 1. 季度独立回测 | 每季度使用该季度的20只ETF池，从净值1.0开始独立回测 |
| 2. 计算等权组合收益 | `季度组合收益 = 池内所有ETF总收益率的平均值` |
| 3. 净值拼接 | `nav = nav × (1 + 季度组合收益 / 100)` |

> **注意**: 此方法**未计算调仓交易成本**（即季度初卖出旧标的、买入新标的的成本）

**论据**: 参见 `scripts/analyze_results_v2.py:173-177`
```python
quarter_return = metrics['portfolio_return']  # 等权平均收益
if not pd.isna(quarter_return):
    nav = nav * (1 + quarter_return / 100)  # 净值累乘
```

### 1.2 实验对比组

| 组别 | 描述 | 标的数量 | 更新频率 |
|------|------|:--------:|:--------:|
| **轮动组** | 每季度使用该季度的评分池独立回测 | 20只/季度 | 季度 |
| **固定组** | 使用2022-2023评分的ADX池全周期回测 | 20只 | 不更新 |

### 1.3 回测参数

| 参数 | 值 | 来源 |
|------|-----|------|
| 回测期间 | 2024-01-01 ~ 2025-11-30 (23个月) | `scripts/run_backtests_v2.py` |
| 策略 | KAMA交叉 | 策略配置 |
| KAMA周期 | 20 | 默认参数 |
| KAMA快线 | 2 | 默认参数 |
| KAMA慢线 | 30 | 默认参数 |

### 1.4 季度轮动安排

| 季度 | 回测区间 | 评分区间 |
|------|----------|----------|
| 2024Q1 | 2024-01-01 ~ 2024-03-31 | 2022-01-01 ~ 2023-12-31 |
| 2024Q2 | 2024-04-01 ~ 2024-06-30 | 2022-04-01 ~ 2024-03-31 |
| 2024Q3 | 2024-07-01 ~ 2024-09-30 | 2022-07-01 ~ 2024-06-30 |
| 2024Q4 | 2024-10-01 ~ 2024-12-31 | 2022-10-01 ~ 2024-09-30 |
| 2025Q1 | 2025-01-01 ~ 2025-03-31 | 2023-01-01 ~ 2024-12-31 |
| 2025Q2 | 2025-04-01 ~ 2025-06-30 | 2023-04-01 ~ 2025-03-31 |
| 2025Q3 | 2025-07-01 ~ 2025-09-30 | 2023-07-01 ~ 2025-06-30 |
| 2025Q4 | 2025-10-01 ~ 2025-11-30 | 2023-10-01 ~ 2025-09-30 |

---

## 二、核心结论

### **结论: 轮动组风险调整收益更优，但绝对收益不如固定组**

| 指标 | 轮动组 | 固定组 | 差值 | 优胜方 |
|------|-------:|-------:|-----:|:------:|
| **总收益率(%)** | 9.14 | 25.90 | -16.77 | 固定组 |
| **年化收益率(%)** | 4.77 | 13.52 | -8.75 | 固定组 |
| **夏普比率** | **0.67** | 0.42 | +0.25 | **轮动组** (+60%) |
| **最大回撤(%)** | **-4.85** | -19.67 | +14.82 | **轮动组** (-75%) |
| 总交易次数 | 76 | 155 | -79 | - |
| 最终净值 | 1.09 | 1.29 | -0.20 | 固定组 |

### 论据来源

**轮动组数据**: `results/comparison_v2/rotation_overall_v2.json`
```json
{
  "total_return": 9.137075101443394,
  "annualized_return": 4.767169618144379,
  "sharpe": 0.6735721484459487,
  "max_drawdown": -4.8469616924,
  "total_trades": "76",
  "final_nav": 1.091370751014434
}
```

**固定组数据**: `results/comparison_v2/static_overall_v2.json`
```json
{
  "total_return": 25.904600000000006,
  "annualized_return": 13.515443478260874,
  "sharpe": 0.42355,
  "max_drawdown": -19.6723,
  "total_trades": "155",
  "final_nav": 1.2903170783342803
}
```

---

## 三、分季度详细数据

### 3.1 轮动组季度表现

| 季度 | ETF数 | 组合收益(%) | 夏普均值 | 最大回撤(%) | 胜率(%) | 交易次数 | 组合净值 |
|------|:-----:|:----------:|:-------:|:---------:|:------:|:-------:|:-------:|
| 2024Q1 | 20 | -0.06 | 0.69 | -0.48 | 0.0 | 2 | 0.9994 |
| 2024Q2 | 20 | -0.15 | -1.27 | -0.89 | 5.0 | 4 | 0.9979 |
| 2024Q3 | 20 | **7.43** | 1.59 | -1.04 | 20.0 | 8 | 1.0720 |
| 2024Q4 | 20 | -1.29 | -0.78 | -2.87 | 20.0 | 15 | 1.0581 |
| 2025Q1 | 20 | -3.60 | -1.62 | -6.90 | 7.5 | 24 | 1.0200 |
| 2025Q2 | 20 | 1.93 | -0.64 | -2.80 | 17.5 | 10 | 1.0397 |
| 2025Q3 | 20 | **4.97** | 0.26 | -2.99 | 30.0 | 13 | 1.0914 |
| 2025Q4 | 20 | 0.00 | - | 0.0 | 0.0 | 0 | 1.0914 |

**论据来源**: `results/comparison_v2/rotation_quarterly_v2.csv`

### 3.2 固定组季度表现

固定组是一次性回测整个23个月，收益被平均分配到各季度（假设收益均匀分布）:

| 季度 | ETF数 | 组合收益(%) | 夏普均值 | 最大回撤(%) | 组合净值 |
|------|:-----:|:----------:|:-------:|:---------:|:-------:|
| 2024Q1 | 20 | 3.38 | 0.42 | -19.67 | 1.03 |
| 2024Q2 | 20 | 3.38 | 0.42 | -19.67 | 1.07 |
| 2024Q3 | 20 | 3.38 | 0.42 | -19.67 | 1.10 |
| 2024Q4 | 20 | 3.38 | 0.42 | -19.67 | 1.14 |
| 2025Q1 | 20 | 3.38 | 0.42 | -19.67 | 1.18 |
| 2025Q2 | 20 | 3.38 | 0.42 | -19.67 | 1.22 |
| 2025Q3 | 20 | 3.38 | 0.42 | -19.67 | 1.26 |
| 2025Q4 | 20 | 2.25 | 0.42 | -19.67 | 1.29 |

**说明**: 固定组的季度收益是从总收益按月数分摊计算的，因为固定组是一次性回测，无法直接获取真实的分季度收益。

**论据来源**: `results/comparison_v2/static_quarterly_v2.csv` + `scripts/analyze_results_v2.py:253-261`

### 3.3 季度收益对比图

```
季度收益(%)
        轮动组  固定组
2024Q1   -0.06   3.38
2024Q2   -0.15   3.38
2024Q3    7.43   3.38  ← 轮动组大幅领先
2024Q4   -1.29   3.38
2025Q1   -3.60   3.38  ← 轮动组大幅落后
2025Q2    1.93   3.38
2025Q3    4.97   3.38  ← 轮动组领先
2025Q4    0.00   2.25
```

**关键观察**: 轮动组收益波动大（标准差3.54% vs 固定组0.40%），但在牛市季度（2024Q3、2025Q3）表现突出。

---

## 四、假设验证

| 假设 | 预期 | 实际结果 | 状态 | 论据 |
|------|------|----------|:----:|------|
| H1: 轮动组夏普 > 固定组 | 轮动更优 | 0.67 vs 0.42 | ✅ **通过** | `rotation_overall_v2.json:5` vs `static_overall_v2.json:5` |
| H2: 轮动组收益稳定性更好 | 波动更小 | 标准差 3.54 vs 0.40 | ❌ 未通过 | `rotation_quarterly_v2.csv` 列`portfolio_return`的std |
| H3: 轮动组最大回撤更小 | 回撤更浅 | -4.85% vs -19.67% | ✅ **通过** | `rotation_overall_v2.json:6` vs `static_overall_v2.json:6` |

### 假设验证详细说明

**H1 (夏普比率) - 通过**
- 轮动组: 0.67，固定组: 0.42
- 差值: +0.25 (+60%)
- 计算方法: `sharpe = annualized_return / (quarterly_std * sqrt(4))`
- 论据: 轮动组年化收益4.77%，季度收益标准差3.54%，年化波动率7.08%

**H2 (收益稳定性) - 未通过**
- 轮动组季度收益标准差: 3.54%
- 固定组季度收益标准差: 0.40% (注: 由于固定组是均匀分摊，实际波动被低估)
- 轮动组收益波动明显更大

**H3 (最大回撤) - 通过**
- 轮动组: -4.85%，固定组: -19.67%
- 差值: +14.82% (回撤减少75%)
- 原因: 季度独立回测，每季度净值重置，累积回撤被抑制

---

## 五、结果解读

### 5.1 轮动组优势

1. **风险调整收益更好 (夏普 +60%)**
   - 论据: 0.67 vs 0.42
   - 原因: 最大回撤大幅降低，风险收益比改善

2. **最大回撤显著减小 (-75%)**
   - 论据: -4.85% vs -19.67%
   - 原因: 季度独立回测，净值每季度重置，避免连续回撤累积

3. **交易更节制 (交易次数 -51%)**
   - 论据: 76次 vs 155次
   - 原因: 短周期回测期间信号更少

### 5.2 轮动组劣势

1. **绝对收益较低**
   - 论据: 9.14% vs 25.90%
   - 原因: 错过了固定池中表现持续优异的标的

2. **收益波动更大**
   - 论据: 季度收益标准差 3.54% vs 0.40%
   - 原因: 每季度换池，无法享受长期趋势

### 5.3 方法论局限性

1. **未计算调仓成本**
   - 每季度平仓再建仓的交易成本被忽略
   - 预估成本: 假设换手率70%，ETF交易成本0.1%，每季度成本约0.14%

2. **固定组季度数据为估算**
   - 固定组是一次性回测，季度收益是按月数均摊的
   - 实际季度波动被低估

3. **最大回撤计算差异**
   - 轮动组: 从季度净值序列计算（可能低估真实回撤）
   - 固定组: 从ETF级别回撤平均计算

---

## 六、后续建议

### 6.1 策略选择建议

| 投资目标 | 推荐策略 | 理由 |
|---------|---------|------|
| 追求绝对收益 | 固定组 | 总收益25.90% vs 9.14% |
| 控制风险、稳健增值 | 轮动组 | 夏普0.67、回撤-4.85% |
| 平衡收益与风险 | 混合策略 | 核心仓位固定池 + 卫星仓位轮动 |

### 6.2 实验改进方向

1. **加入调仓成本模拟**
   - 计算季度初的换仓交易成本
   - 更真实地评估轮动策略的净收益

2. **固定组分季度回测**
   - 将固定组也改为季度独立回测
   - 使两组的计算方法完全一致

3. **测试不同轮动频率**
   - 半年度轮动
   - 年度轮动
   - 对比不同频率的收益-成本平衡

---

## 七、文件索引

### 输入文件

| 文件 | 路径 | 说明 |
|------|------|------|
| 轮动表 | `pool_rotation_schedule.json` | 8个季度的池子安排 |
| 各季度ETF池 | `pools/*/pool.csv` | 每季度20只ETF |
| 固定组ETF池 | `../selector_score/pool_2022_2023/single_adx_score_pool_2022_2023.csv` | 20只固定ETF |

### 输出文件 (v2)

| 文件 | 路径 | 说明 |
|------|------|------|
| 轮动组整体 | `results/comparison_v2/rotation_overall_v2.json` | 轮动组整体统计 |
| 固定组整体 | `results/comparison_v2/static_overall_v2.json` | 固定组整体统计 |
| 轮动组季度 | `results/comparison_v2/rotation_quarterly_v2.csv` | 轮动组分季度统计 |
| 固定组季度 | `results/comparison_v2/static_quarterly_v2.csv` | 固定组分季度统计 |
| 分析报告 | `results/comparison_v2/ANALYSIS_REPORT_V2.md` | 自动生成的简要报告 |

### 脚本文件 (v2)

| 脚本 | 路径 | 说明 |
|------|------|------|
| 回测脚本 | `scripts/run_backtests_v2.py` | 季度独立回测 |
| 分析脚本 | `scripts/analyze_results_v2.py` | 净值计算和对比分析 |

---

## 八、复现指南

### 8.1 执行v2实验

```bash
cd /mnt/d/git/backtesting

# 步骤1: 运行季度独立回测
python experiment/etf/quarterly_rotation/scripts/run_backtests_v2.py

# 步骤2: 分析结果
python experiment/etf/quarterly_rotation/scripts/analyze_results_v2.py
```

### 8.2 查看结果

```bash
# 查看整体对比
cat experiment/etf/quarterly_rotation/results/comparison_v2/rotation_overall_v2.json
cat experiment/etf/quarterly_rotation/results/comparison_v2/static_overall_v2.json

# 查看季度明细
cat experiment/etf/quarterly_rotation/results/comparison_v2/rotation_quarterly_v2.csv
```

---

*报告生成时间: 2025-12-08*
*版本: v2 (分季度独立回测)*
