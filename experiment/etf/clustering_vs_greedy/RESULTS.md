# 聚类 vs 贪心对比实验结果报告

## 1. 实验概述

**实验目标**: 验证层次聚类选择算法是否优于贪心算法+硬编码行业分类

**实验规模**:
- 总对比组数: 12组（6维度 × 2周期）
- 评分维度: 6个（ADX、流动性、价格效率、趋势一致性、动量12m、趋势质量）
- 筛选周期: 2个（2019-2021熊市前、2022-2023牛市前）
- 回测周期: 2个（2022-2023熊市、2024-2025牛市）
- 总回测次数: 约460次（24池 × ~19只ETF）

**数据来源文件**:
- 配对比较: `analysis/pairwise_comparison.csv`
- 池生成统计: `analysis/pool_generation_summary.csv`
- 回测结果: `analysis/backtest_results_summary.csv`

## 2. 核心结论

### 主要发现: 贪心算法整体优于聚类选择

**数据来源**: `analysis/pairwise_comparison.csv` (第2-13行)

统计聚类胜出次数（sharpe_winner列）:
- clustering胜出: 5次 (行2,4,5,7,10)
- greedy胜出: 7次 (行3,6,8,9,11,12,13)

| 指标 | 聚类算法 | 贪心算法 | 计算方式 |
|------|---------|---------|---------|
| 胜率 | 5/12 (41.7%) | **7/12 (58.3%)** | pairwise_comparison.csv sharpe_winner列统计 |
| 平均夏普差异 | -0.0173 | - | pairwise_comparison.csv sharpe_diff列均值 |

**平均夏普差异计算** (sharpe_diff列):
```
(0.118 - 0.250 + 0.361 + 0.077 - 0.306 + 0.074 - 0.183 - 0.040 + 0.129 - 0.017 - 0.111 - 0.060) / 12 = -0.0173
```

## 3. 相关性分析

**数据来源**: `analysis/pool_generation_summary.csv` (第2-25行)

### 池内相关性对比

| 算法 | 平均相关性 | 计算来源 |
|------|-----------|---------|
| 贪心算法 | 0.396 | pool_generation_summary.csv 行3,5,7,9,11,13,15,17,19,21,23,25 avg_correlation列均值 |
| 聚类算法 | 0.276 | pool_generation_summary.csv 行2,4,6,8,10,12,14,16,18,20,22,24 avg_correlation列均值 |

**贪心算法相关性计算**:
```
(0.366 + 0.403 + 0.476 + 0.514 + 0.386 + 0.382 + 0.329 + 0.270 + 0.373 + 0.410 + 0.463 + 0.383) / 12 = 0.396
```

**聚类算法相关性计算**:
```
(0.211 + 0.314 + 0.330 + 0.308 + 0.308 + 0.232 + 0.291 + 0.232 + 0.265 + 0.274 + 0.268 + 0.279) / 12 = 0.276
```

**相关性降低**: (0.396 - 0.276) / 0.396 = **30.3%**

## 4. 分市场分析

**数据来源**: `analysis/pairwise_comparison.csv`

### 熊市 (2022-2023回测) - 行2,4,6,8,10,12

| 维度 | 贪心夏普 | 聚类夏普 | 差异 | 胜者 |
|------|----------|----------|------|------|
| adx_score (行2) | -0.622 | -0.504 | +0.118 | 聚类 |
| liquidity_score (行4) | -0.441 | -0.079 | +0.361 | 聚类 |
| momentum_12m (行6) | +0.131 | -0.175 | -0.306 | 贪心 |
| price_efficiency (行8) | -0.001 | -0.184 | -0.183 | 贪心 |
| trend_consistency (行10) | -0.507 | -0.377 | +0.129 | 聚类 |
| trend_quality (行12) | -0.266 | -0.376 | -0.111 | 贪心 |

**熊市统计**: 聚类3胜，贪心3胜，**平手**
**熊市平均夏普差异**: (0.118 + 0.361 - 0.306 - 0.183 + 0.129 - 0.111) / 6 = **+0.0013**

### 牛市 (2024-2025回测) - 行3,5,7,9,11,13

| 维度 | 贪心夏普 | 聚类夏普 | 差异 | 胜者 |
|------|----------|----------|------|------|
| adx_score (行3) | +0.424 | +0.173 | -0.250 | 贪心 |
| liquidity_score (行5) | -0.104 | -0.027 | +0.077 | 聚类 |
| momentum_12m (行7) | -0.107 | -0.033 | +0.074 | 聚类 |
| price_efficiency (行9) | -0.002 | -0.042 | -0.040 | 贪心 |
| trend_consistency (行11) | +0.104 | +0.086 | -0.017 | 贪心 |
| trend_quality (行13) | +0.115 | +0.055 | -0.060 | 贪心 |

**牛市统计**: 聚类2胜，贪心4胜，**贪心优势明显**
**牛市平均夏普差异**: (-0.250 + 0.077 + 0.074 - 0.040 - 0.017 - 0.060) / 6 = **-0.036**

## 5. 详细对比表

**数据来源**: `analysis/pairwise_comparison.csv` 完整数据

| 维度 | 周期 | 市场 | 贪心夏普 | 聚类夏普 | 差异 | 胜者 | 来源行 |
|------|------|------|----------|----------|------|------|--------|
| adx_score | 2019_2021 | 熊市 | -0.622 | -0.504 | +0.118 | **聚类** | 行2 |
| adx_score | 2022_2023 | 牛市 | **+0.424** | +0.173 | -0.250 | **贪心** | 行3 |
| liquidity_score | 2019_2021 | 熊市 | -0.441 | **-0.079** | +0.361 | **聚类** | 行4 |
| liquidity_score | 2022_2023 | 牛市 | -0.104 | **-0.027** | +0.077 | **聚类** | 行5 |
| momentum_12m | 2019_2021 | 熊市 | **+0.131** | -0.175 | -0.306 | **贪心** | 行6 |
| momentum_12m | 2022_2023 | 牛市 | -0.107 | **-0.033** | +0.074 | **聚类** | 行7 |
| price_efficiency | 2019_2021 | 熊市 | **-0.001** | -0.184 | -0.183 | **贪心** | 行8 |
| price_efficiency | 2022_2023 | 牛市 | **-0.002** | -0.042 | -0.040 | **贪心** | 行9 |
| trend_consistency | 2019_2021 | 熊市 | -0.507 | **-0.377** | +0.129 | **聚类** | 行10 |
| trend_consistency | 2022_2023 | 牛市 | **+0.104** | +0.086 | -0.017 | **贪心** | 行11 |
| trend_quality | 2019_2021 | 熊市 | **-0.266** | -0.376 | -0.111 | **贪心** | 行12 |
| trend_quality | 2022_2023 | 牛市 | **+0.115** | +0.055 | -0.060 | **贪心** | 行13 |

## 6. 按维度分析

**数据来源**: `analysis/pairwise_comparison.csv` sharpe_winner列按dimension分组统计

| 维度 | 聚类胜出 | 贪心胜出 | 推荐算法 | 来源行 |
|------|---------|---------|---------|--------|
| **liquidity_score** | **2/2** | 0/2 | **聚类** | 行4,5 |
| adx_score | 1/2 | 1/2 | 平手 | 行2,3 |
| momentum_12m | 1/2 | 1/2 | 平手 | 行6,7 |
| trend_consistency | 1/2 | 1/2 | 平手 | 行10,11 |
| price_efficiency | 0/2 | **2/2** | **贪心** | 行8,9 |
| trend_quality | 0/2 | **2/2** | **贪心** | 行12,13 |

## 7. 回测详细数据

**数据来源**: `analysis/backtest_results_summary.csv`

### 熊市回测 (2022-2023) - 行2-13

| 池名称 | ETF数 | 平均收益% | 平均夏普 | 来源行 |
|--------|-------|----------|----------|--------|
| adx_score_clustering | 20 | -4.22 | -0.504 | 行2 |
| adx_score_greedy | 20 | -6.24 | -0.622 | 行3 |
| liquidity_score_clustering | 18 | -0.23 | -0.079 | 行4 |
| liquidity_score_greedy | 20 | -2.42 | -0.441 | 行5 |
| momentum_12m_clustering | 20 | -0.82 | -0.175 | 行6 |
| momentum_12m_greedy | 20 | +3.96 | +0.131 | 行7 |
| price_efficiency_clustering | 20 | -1.45 | -0.184 | 行8 |
| price_efficiency_greedy | 20 | +2.06 | -0.001 | 行9 |
| trend_consistency_clustering | 19 | -2.91 | -0.377 | 行10 |
| trend_consistency_greedy | 20 | -4.96 | -0.507 | 行11 |
| trend_quality_clustering | 19 | -4.02 | -0.376 | 行12 |
| trend_quality_greedy | 20 | -0.98 | -0.266 | 行13 |

### 牛市回测 (2024-2025) - 行14-25

| 池名称 | ETF数 | 平均收益% | 平均夏普 | 来源行 |
|--------|-------|----------|----------|--------|
| adx_score_clustering | 20 | +7.74 | +0.173 | 行14 |
| adx_score_greedy | 20 | +12.47 | +0.424 | 行15 |
| liquidity_score_clustering | 19 | +0.68 | -0.027 | 行16 |
| liquidity_score_greedy | 20 | +7.46 | -0.104 | 行17 |
| momentum_12m_clustering | 20 | +3.14 | -0.033 | 行18 |
| momentum_12m_greedy | 20 | +0.38 | -0.107 | 行19 |
| price_efficiency_clustering | 20 | +6.02 | -0.042 | 行20 |
| price_efficiency_greedy | 20 | +6.38 | -0.002 | 行21 |
| trend_consistency_clustering | 20 | +6.68 | +0.086 | 行22 |
| trend_consistency_greedy | 20 | +6.98 | +0.104 | 行23 |
| trend_quality_clustering | 18 | +5.96 | +0.055 | 行24 |
| trend_quality_greedy | 20 | +4.18 | +0.115 | 行25 |

## 8. 最终建议

### 默认推荐: 贪心算法

**理由** (基于上述数据):
1. 整体胜率更高: 7/12 (58.3%) vs 5/12 (41.7%)
2. 牛市优势明显: 4/6 (66.7%) vs 2/6 (33.3%)
3. 实现简单，无需scipy依赖

### 场景化建议

| 场景 | 推荐算法 | 数据支持 |
|------|---------|---------|
| **默认/牛市** | 贪心 | 牛市胜率66.7% (pairwise_comparison.csv 行3,5,7,9,11,13) |
| **熊市/高波动** | 聚类 | 熊市平手，但相关性低30% |
| **流动性优先** | 聚类 | 该维度100%胜出 (行4,5) |
| **趋势质量优先** | 贪心 | 该维度100%胜出 (行12,13) |

## 9. 实验局限性

1. **样本量有限**: 12组对比可能不足以得出统计显著结论
2. **时间跨度**: 仅覆盖2022-2025年
3. **单一策略**: 仅使用KAMA策略
4. **固定参数**: 聚类参数（ward方法、20%阈值）未做优化

---

**实验完成时间**: 2025-12-09
**数据文件位置**: `experiment/etf/clustering_vs_greedy/analysis/`
- `pairwise_comparison.csv` - 配对比较结果 (13行)
- `pool_generation_summary.csv` - 池生成统计 (25行)
- `backtest_results_summary.csv` - 回测汇总 (25行)
