# V2 vs V1 æ¡†æ¶å¯¹æ¯”å®éªŒè®¾è®¡æ–‡æ¡£

**å®éªŒæ—¥æœŸ**: 2025-12-12
**å®éªŒç›®çš„**: å¯¹æ¯” ETF è¶‹åŠ¿è·Ÿè¸ª V2 æ¡†æ¶ä¸æ—§æ¡†æ¶(V1)åœ¨ç†Šå¸‚/ç‰›å¸‚ä¸åŒå¸‚åœºç¯å¢ƒä¸‹çš„å›æµ‹è¡¨ç°
**å®éªŒçŠ¶æ€**: å·²å®¡é˜…ä¿®è®¢ (v4.0)
**ä¿®è®¢æ—¥æœŸ**: 2025-12-13

---

## âš ï¸ é‡è¦çº¦æŸå£°æ˜

æ ¹æ®éœ€æ±‚æ–‡æ¡£ `requirement_docs/20251211_etf_trend_following_v2_requirement.md` Section 16.4ï¼ˆå†å²çŠ¶æ€ï¼‰ï¼š

> **å½“å‰ V2 æ¡†æ¶ä¸ºå•æ ‡çš„ç‹¬ç«‹å›æµ‹ï¼Œä¸æ”¯æŒåŠ¨æ€ä»“ä½åˆ†é…ã€ç°‡é™åˆ¶ã€åŠ¨é‡æ’åé€‰ä¼˜**

**ç°çŠ¶æ›´æ–°ï¼ˆâœ… å·²è½åœ°ï¼‰**ï¼šç»„åˆçº§å›æµ‹å·²å®ç° `PortfolioBacktestRunner`ï¼ˆ`etf_trend_following_v2/src/portfolio_backtest_runner.py`ï¼‰ï¼Œ
æ”¯æŒ **TopN+ç¼“å†²å¸¦**ã€**åˆ†ç°‡é™é¢**ã€**æ³¢åŠ¨ç‡å€’æ•°ä»“ä½**ã€**ä½£é‡‘+æ»‘ç‚¹** çš„ç»„åˆçº§æ¨¡æ‹Ÿä¸ç»“æœè½ç›˜ã€‚

å› æ­¤ï¼Œæœ¬å®éªŒä»ä¿ç•™ **Phase 1/2 å•æ ‡çš„å›æµ‹å¯¹æ¯”**ï¼ˆå…¬å¹³å¯¹é½ V1ï¼‰ï¼Œå¹¶æ–°å¢ **Phase 3 ç»„åˆçº§å›æµ‹éªŒè¯**ï¼ˆéªŒè¯ V2 è®¾è®¡ç›®æ ‡æœºåˆ¶ï¼‰ã€‚

---

## 1. å®éªŒèƒŒæ™¯

### 1.1 æ¡†æ¶æ ¸å¿ƒå·®å¼‚

**V1 æ¡†æ¶ï¼ˆæ—§æ¡†æ¶ï¼‰**:
- **æ ‡çš„é€‰æ‹©**: ä½¿ç”¨é¢„å…ˆç­›é€‰çš„å›ºå®š ETF æ± ï¼ˆå¦‚ `results/trend_etf_pool.csv`ï¼‰
- **ç­–ç•¥é€»è¾‘**: å•æ ‡çš„ç‹¬ç«‹å›æµ‹ï¼Œç­–ç•¥ä¿¡å·ç›´æ¥è§¦å‘ä¹°å–
- **ä»“ä½ç®¡ç†**: å›ºå®šä»“ä½ï¼Œæ— åŠ¨æ€è°ƒæ•´
- **é£æ§**: å¯é€‰çš„è·Ÿè¸ªæ­¢æŸå’Œè¿ç»­æ­¢æŸä¿æŠ¤

**V2 æ¡†æ¶ï¼ˆæ–°æ¡†æ¶ï¼‰**:
- **æ ‡çš„é€‰æ‹©**:
  - âœ… **å½“å‰å®ç°**: é™æ€æ± æ–‡ä»¶/é…ç½®åˆ—è¡¨ + ç»„åˆçº§å›æµ‹ï¼ˆTopN/ç°‡é™é¢/ä»“ä½ï¼‰
  - ğŸ”® **è®¾è®¡ç›®æ ‡**: å…¨æ± åŠ¨æ€ç­›é€‰ï¼ˆGemini æ–¹æ¡ˆï¼‰ï¼Œå¾…å…¨æ± æ•°æ®/è¿è¡Œæ•ˆç‡ä¼˜åŒ–
- **ä»“ä½ç®¡ç†**:
  - âœ… **å½“å‰å®ç°**: æ³¢åŠ¨ç‡å€’æ•°åŠ æƒ + å•æ ‡/ç°‡/æ€»ä»“ä½ä¸Šé™ï¼ˆç»„åˆçº§å›æµ‹ï¼‰
- **é£æ§**ï¼ˆâœ… å·²å®ç°ï¼‰:
  - ATR ç§»åŠ¨æ­¢æŸï¼ˆChandelier Exitï¼‰
  - æ—¶é—´æ­¢æŸï¼ˆæŒä»“ N å¤©æ— ç›ˆåˆ©åˆ™å¹³ä»“ï¼‰
  - Loss Protectionï¼ˆè¿ç»­æ­¢æŸä¿æŠ¤ï¼‰
  - Trailing Stopï¼ˆè·Ÿè¸ªæ­¢æŸï¼‰

### 1.2 æ ¸å¿ƒè®¾è®¡ç†å¿µå¯¹æ¯”

| ç»´åº¦ | V1 (æ—§æ¡†æ¶) | V2 (å½“å‰å®ç°) | V2 (è®¾è®¡ç›®æ ‡) |
|------|------------|--------------|--------------|
| **å“²å­¦** | å›ºå®šæ± å­ + ä¿¡å·æ‹©æ—¶ | å›ºå®šæ± å­ + å¢å¼ºé£æ§ | å…¨æ± ç›‘æ§ + åŠ¨æ€é€‰ä¼˜ |
| **æ ‡çš„æ¥æº** | é¢„ç­›é€‰é™æ€æ±  | é¢„ç­›é€‰é™æ€æ±  | å…¨å¸‚åœºåŠ¨æ€ç­›é€‰ |
| **ä¹°å…¥é€»è¾‘** | ä¿¡å·è§¦å‘å³ä¹° | ä¿¡å·è§¦å‘å³ä¹° | ä¿¡å· + æ’å Top N |
| **å–å‡ºé€»è¾‘** | ä¿¡å·åè½¬/æ­¢æŸ | ä¿¡å·åè½¬/æ­¢æŸ | æ­¢æŸ > æ’ååŠ£æ±° > ä¿¡å·åè½¬ |
| **ä»“ä½** | å›ºå®š/ç­‰æƒ | å›ºå®š/ç­‰æƒ | æ³¢åŠ¨ç‡å€’æ•°åŠ æƒ |
| **åˆ†æ•£åº¦** | æ— çº¦æŸ | æ— çº¦æŸ | åˆ†ç°‡é™é¢ |
| **æ¢ä»“æ§åˆ¶** | æ—  | æ—  | ç¼“å†²å¸¦ + æƒ¯æ€§åŠ åˆ† |
| **é£æ§å¢å¼º** | å¯é€‰ | âœ… ATR/æ—¶é—´æ­¢æŸ | ATR/æ—¶é—´æ­¢æŸ + ç†”æ–­ |

### 1.3 V2 æ¡†æ¶çš„ ETF å‡†å…¥æœºåˆ¶

> âš ï¸ **æ³¨æ„**: ä»¥ä¸‹ä¸º V2 **è®¾è®¡ç›®æ ‡**ï¼Œå½“å‰å®ç°ä»ä½¿ç”¨é™æ€æ± æ–‡ä»¶ã€‚æœ¬å®éªŒä½¿ç”¨é™æ€æ± è¿›è¡Œå•æ ‡çš„å›æµ‹å¯¹æ¯”ã€‚

**è®¾è®¡ç›®æ ‡**ï¼ˆéƒ¨åˆ†å·²è½åœ°ï¼‰:

1. **æµåŠ¨æ€§é¢„ç­›é€‰**ï¼ˆconfig.universe.liquidity_thresholdï¼‰:

   **åŸºäºå®é™…æ•°æ®åˆ†æçš„é˜ˆå€¼è®¾å®š**ï¼ˆæ•°æ®æ¥æº: `data/chinese_etf/daily/etf/`ï¼Œ1530åªæœ‰æ•ˆETFï¼‰ï¼š

   | æŒ‡æ ‡ | åˆ†ä½ç‚¹åˆ†å¸ƒ |
   |------|-----------|
   | **å¹³å‡æˆäº¤é¢** | P25=108ä¸‡, P50=801ä¸‡, P75=4637ä¸‡, P90=2.46äº¿ |
   | **å¹³å‡æˆäº¤é‡** | P25=7,362è‚¡, P50=64,485è‚¡, P75=38.6ä¸‡è‚¡, P90=184.5ä¸‡è‚¡ |

   **ç»„åˆé˜ˆå€¼ä¸ç­›é€‰ç»“æœ**:

   | æˆäº¤é¢é˜ˆå€¼ | æˆäº¤é‡é˜ˆå€¼ | ä¿ç•™æ•°é‡ | ä¿ç•™æ¯”ä¾‹ | è¯´æ˜ |
   |-----------|-----------|---------|---------|------|
   | 100ä¸‡ | 10ä¸‡è‚¡ | ~660 | 43.1% | å®½æ¾ |
   | **500ä¸‡** | **50ä¸‡è‚¡** | **~339** | **22.2%** | **âœ… æ¨èï¼ˆæœ¬å®éªŒä½¿ç”¨ï¼‰** |
   | 1000ä¸‡ | 100ä¸‡è‚¡ | ~225 | 14.7% | ä¸¥æ ¼ |
   | 5000ä¸‡ | 500ä¸‡è‚¡ | ~64 | 4.2% | é«˜æµåŠ¨æ€§ |

   **æœ¬å®éªŒé…ç½®**:
   - `min_avg_amount`: **5,000,000 å…ƒ**ï¼ˆ500ä¸‡ï¼‰
   - `min_avg_volume`: **500,000 è‚¡**ï¼ˆ50ä¸‡è‚¡ï¼‰
   - âœ… `example_config.json` å·²æ›´æ–°ä¸º 500ä¸‡/50ä¸‡è‚¡ï¼ˆ`etf_trend_following_v2/config/example_config.json`ï¼‰

2. **è¶‹åŠ¿ä¿¡å·è¿‡æ»¤**ï¼ˆç­–ç•¥ä¿¡å·ä½œä¸º Gatekeeperï¼‰:
   - MACD é‡‘å‰/æ­»å‰
   - KAMA ä»·æ ¼ç©¿è¶Š
   - åªæœ‰äº§ç”Ÿä¹°å…¥ä¿¡å·çš„æ ‡çš„æ‰èƒ½å‚ä¸æ’å

3. **åŠ¨é‡æ’åé€‰ä¼˜**ï¼ˆâœ… å·²å®ç°ï¼šç»„åˆçº§å›æµ‹ï¼‰:
   - å¤šå‘¨æœŸæ³¢åŠ¨ç‡åŠ æƒåŠ¨é‡å¾—åˆ†: `Score = Î£(weight_i Ã— return_i / volatility_i)`
   - é»˜è®¤å‘¨æœŸ: 20æ—¥(40%), 60æ—¥(30%), 120æ—¥(30%)
   - Top N è¿›å…¥å€™é€‰æ±  (é»˜è®¤ buy_top_n=10)

4. **åˆ†ç°‡è¿‡æ»¤**ï¼ˆâœ… å·²å®ç°ï¼šç»„åˆçº§å›æµ‹ï¼‰:
   - ç›¸å…³æ€§èšç±»ï¼ˆ120æ—¥ç›¸å…³æ€§ï¼Œé˜ˆå€¼ 0.5ï¼‰
   - æ¯ç°‡æœ€å¤šæŒæœ‰ 2 åª
   - åŒç°‡ç«äº‰æ—¶é€‰æ‹©é£é™©è°ƒæ•´åŠ¨é‡æœ€é«˜çš„

---

## 2. å®éªŒè®¾è®¡

### 2.1 æµ‹è¯•å‘¨æœŸ

| å‘¨æœŸåç§° | èµ·å§‹æ—¥æœŸ | ç»“æŸæ—¥æœŸ | å¸‚åœºç‰¹å¾ | éªŒè¯ç›®æ ‡ |
|---------|---------|---------|---------|---------|
| **ç†Šå¸‚å‘¨æœŸ** | 2022-01-01 | 2023-12-31 | ä¸‹è·Œ/éœ‡è¡ | é£æ§èƒ½åŠ›ï¼šæ­¢æŸã€ç©ºä»“é¿é™© |
| **ç‰›å¸‚å‘¨æœŸ** | 2024-01-01 | 2025-11-30 | ä¸Šæ¶¨/åå¼¹ | æ”¶ç›Šæ•è·ï¼šä¿¡å·è´¨é‡ã€é£æ§å¢å¼º |

### 2.2 æµ‹è¯•æ ‡çš„

> âš ï¸ **å‰è§†åå·®ä¿®å¤**: åŸè®¾è®¡ä½¿ç”¨ 2022-2023 è¯„åˆ†æœŸç­›é€‰ ETF æ± ï¼Œç„¶ååœ¨åŒä¸€æ—¶é—´æ®µï¼ˆ2022-2023ï¼‰è¿›è¡Œç†Šå¸‚å›æµ‹ï¼Œå­˜åœ¨æ ·æœ¬å†…é€‰è‚¡çš„å‰è§†åå·®ã€‚ç°å·²ä¿®æ­£ä¸ºä½¿ç”¨æ›´æ—©çš„è¯„åˆ†æœŸã€‚

**V1 æ¡†æ¶**: ä½¿ç”¨ `experiment/etf/selector_score/` å®éªŒç»“æœæ¨èçš„æœ€ä¼˜é…ç½®

| æµ‹è¯•å‘¨æœŸ | è¯„åˆ†æœŸ | è¯´æ˜ |
|---------|--------|------|
| **ç†Šå¸‚ (2022-2023)** | **2019-2021** | âœ… æ ·æœ¬å¤–æµ‹è¯•ï¼Œæ— å‰è§†åå·® |
| **ç‰›å¸‚ (2024-2025)** | **2022-2023** | âœ… æ ·æœ¬å¤–æµ‹è¯•ï¼Œæ— å‰è§†åå·® |

æ ¹æ® `selector_score` å®éªŒç»“è®ºï¼š
- **æœ€ä¼˜ç»´åº¦**: ADX è¶‹åŠ¿å¼ºåº¦
- ä½¿ç”¨ ADX ç»´åº¦ç­›é€‰å‡ºçš„ Top 20 ETF ä½œä¸º V1 æµ‹è¯•æ± 
- âœ… **ç†Šå¸‚æ± å·²ç”Ÿæˆ**: `results/trend_etf_pool_2019_2021.csv`ï¼ˆå»ºè®®ä»å¤æ ¸è¯„åˆ†é…ç½®æ˜¯å¦ä¸º ADX Top 20ï¼‰

**V2 æ¡†æ¶**: ä½¿ç”¨é™æ€ ETF æ± ï¼ˆä¸ V1 ç›¸åŒï¼‰ + å•æ ‡çš„å›æµ‹å¯¹é½éªŒè¯ + ç»„åˆçº§å›æµ‹æœºåˆ¶éªŒè¯

- æ•°æ®æº: `data/chinese_etf/daily/etf/`
- ä½¿ç”¨ä¸ V1 ç›¸åŒçš„ ETF æ± ï¼Œç¡®ä¿å¯¹æ¯”å…¬å¹³
- âš ï¸ å½“å‰ä»ä¸æ”¯æŒå…¨æ± åŠ¨æ€ç­›é€‰ï¼ˆç»„åˆçº§å›æµ‹å·²æ”¯æŒï¼Œä½†æ ‡çš„æ± ä»ä¸ºé™æ€æ± æ–‡ä»¶/åˆ—è¡¨ï¼‰

### 2.3 è¯„ä¼°æŒ‡æ ‡

**æ ¸å¿ƒæŒ‡æ ‡**:

| æŒ‡æ ‡ | è®¡ç®—æ–¹æ³• | é‡è¦æ€§ |
|------|---------|--------|
| **å¹´åŒ–æ”¶ç›Šç‡** | `(1 + æ€»æ”¶ç›Š)^(252/äº¤æ˜“å¤©æ•°) - 1` | â­â­â­ |
| **å¤æ™®æ¯”ç‡** | `(å¹´åŒ–æ”¶ç›Š - 3%) / å¹´åŒ–æ³¢åŠ¨ç‡` | â­â­â­ |
| **æœ€å¤§å›æ’¤** | `min(ç´¯è®¡æ”¶ç›Š / å†å²æœ€é«˜ç´¯è®¡æ”¶ç›Š - 1)` | â­â­â­ |
| **èƒœç‡** | `ç›ˆåˆ©äº¤æ˜“æ•° / æ€»äº¤æ˜“æ•°` | â­â­ |

**æˆæœ¬æ•æ„Ÿæ€§æŒ‡æ ‡**ï¼ˆæ–°å¢ï¼‰:

| æŒ‡æ ‡ | è®¡ç®—æ–¹æ³• | é‡è¦æ€§ | è¯´æ˜ |
|------|---------|--------|------|
| **æ¢æ‰‹ç‡** | `æ€»äº¤æ˜“é‡‘é¢ / (2 Ã— å¹³å‡æŒä»“å¸‚å€¼)` | â­â­â­ | V2 TopN è½®åŠ¨å¯¹æˆæœ¬æ•æ„Ÿ |
| **äº¤æ˜“æ¬¡æ•°** | ä¹°å…¥ + å–å‡ºæ¬¡æ•° | â­â­ | é¢‘ç¹äº¤æ˜“å¢åŠ æ»‘ç‚¹æˆæœ¬ |
| **æ»‘ç‚¹æ•æ„Ÿæ€§** | ä¸åŒæ»‘ç‚¹å‡è®¾ä¸‹çš„æ”¶ç›Šå˜åŒ– | â­â­ | æµ‹è¯• 0/5/10 bps æ»‘ç‚¹ |
| **æˆæœ¬è°ƒæ•´æ”¶ç›Š** | `æ€»æ”¶ç›Š - äº¤æ˜“æˆæœ¬ - æ»‘ç‚¹æˆæœ¬` | â­â­â­ | çœŸå®å¯å®ç°æ”¶ç›Š |

**æ»‘ç‚¹æ•æ„Ÿæ€§æµ‹è¯•é…ç½®**:
```
æ»‘ç‚¹å‡è®¾: [0 bps, 5 bps, 10 bps]
æ‰‹ç»­è´¹: ä¸‡ä¸‰ (0.0003)
```

### 2.4 æ¡†æ¶é…ç½®

> âš ï¸ **å…¬å¹³å¯¹æ¯”åŸåˆ™**: ä¸ºç¡®ä¿æ€§èƒ½å·®å¼‚æ¥è‡ªæ¡†æ¶è€Œéé£æ§/ä»“ä½è®¾è®¡ï¼Œéœ€è¦è®¾ç½®å¯¹ç§°çš„å¯¹ç…§ç»„ã€‚

#### V1 æ¡†æ¶é…ç½®

**åŸºçº¿é…ç½®ï¼ˆæ— é£æ§ï¼‰**:

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|-------|-----|------|
| ETF æ±  | ADX ç»´åº¦ Top 20 | æŒ‰æµ‹è¯•å‘¨æœŸä½¿ç”¨å¯¹åº”è¯„åˆ†æœŸ |
| ç­–ç•¥ | KAMA Baseline | å¤æ™®æœ€ä¼˜ |
| å‚æ•° | period=20, fast=2, slow=30 | é»˜è®¤å‚æ•° |
| æ­¢æŸ | âŒ ä¸å¯ç”¨ | åŸºçº¿å¯¹ç…§ |
| ä»“ä½ | å›ºå®š 90% | ç­‰æƒ |

**å¢å¼ºé…ç½®ï¼ˆå¯ç”¨é£æ§ï¼‰**:

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|-------|-----|------|
| ATR æ­¢æŸ | âœ… å¯ç”¨ | `atr_window=14, atr_multiplier=2.0` |
| æ—¶é—´æ­¢æŸ | âœ… å¯ç”¨ | `time_stop_days=60` |
| Loss Protection | âœ… å¯ç”¨ | `max_consecutive_losses=3, pause_bars=10` |

**å¯¹ç…§ç»„**: MACD Baseline + Combined æ­¢æŸ

#### V2 æ¡†æ¶é…ç½®

ä½¿ç”¨ `etf_trend_following_v2/config/` ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ã€‚

**åŸºçº¿é…ç½®ï¼ˆæ— é£æ§ï¼‰** - `v2_kama_baseline.json`:

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|-------|-----|------|
| ç­–ç•¥ | KAMA | period=20, fast=2, slow=30 |
| ATR æ­¢æŸ | âŒ ç¦ç”¨ | ä¸ V1 åŸºçº¿å¯¹é½ |
| æ—¶é—´æ­¢æŸ | âŒ ç¦ç”¨ | ä¸ V1 åŸºçº¿å¯¹é½ |
| Loss Protection | âŒ ç¦ç”¨ | ä¸ V1 åŸºçº¿å¯¹é½ |
| ä»“ä½ | å›ºå®š 90% | ä¸ V1 åŸºçº¿å¯¹é½ |

**å¢å¼ºé…ç½®ï¼ˆå¯ç”¨é£æ§ï¼‰** - `v2_kama_enhanced.json`:

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|-------|-----|------|
| ç­–ç•¥ | KAMA | period=20, fast=2, slow=30 |
| ATR æ­¢æŸ | âœ… å¯ç”¨ | `atr_window=14, atr_multiplier=2.0` |
| æ—¶é—´æ­¢æŸ | âœ… å¯ç”¨ | `time_stop_days=60` |
| Loss Protection | âœ… å¯ç”¨ | `max_consecutive_losses=3, pause_bars=10` |
| ä»“ä½ | å›ºå®š 90% | å•æ ‡çš„å›æµ‹ |

**åŠ¨é‡æ’åé…ç½®**ï¼ˆâœ… å·²æ”¯æŒï¼šç»„åˆçº§å›æµ‹ï¼‰:
```json
{
  "scoring": {
    "momentum_weights": {"20d": 0.4, "60d": 0.3, "120d": 0.3},
    "buffer_thresholds": {"buy_top_n": 10, "hold_until_rank": 15},
    "inertia_bonus": 0.05
  }
}
```

**èšç±»é…ç½®**ï¼ˆâœ… å·²æ”¯æŒï¼šç»„åˆçº§å›æµ‹ï¼‰:
```json
{
  "clustering": {
    "correlation_window": 60,
    "cut_threshold": 0.5,
    "max_positions_per_cluster": 2
  }
}
```

**ä»“ä½ç®¡ç†**ï¼ˆâœ… å·²æ”¯æŒï¼šç»„åˆçº§å›æµ‹ï¼‰:
```json
{
  "position_sizing": {
    "method": "inverse_volatility",
    "max_positions": 20,
    "max_position_size": 0.15
  }
}
```

---

## 3. å®éªŒé˜¶æ®µ

### Phase 0: å‰ç½®å‡†å¤‡ï¼ˆå¿…é¡»å…ˆå®Œæˆï¼‰

**ç›®æ ‡**: æ­å»ºå®éªŒè„šæœ¬/é…ç½®éª¨æ¶ï¼Œç¡®ä¿å®éªŒå¯å¤ç°

**ä»»åŠ¡æ¸…å•**:
1. [ ] åˆ›å»º `scripts/` ç›®å½•å’Œå›æµ‹è„šæœ¬éª¨æ¶
2. [ ] åˆ›å»º `configs/` ç›®å½•å’Œé…ç½®æ–‡ä»¶
3. [x] ç”Ÿæˆ 2019-2021 è¯„åˆ†æœŸçš„ ETF æ± ï¼ˆç”¨äºç†Šå¸‚æµ‹è¯•ï¼‰ï¼š`results/trend_etf_pool_2019_2021.csv`
4. [x] æ›´æ–° `example_config.json` æµåŠ¨æ€§é˜ˆå€¼ä¸º 500ä¸‡/50ä¸‡è‚¡ï¼š`etf_trend_following_v2/config/example_config.json`
5. [ ] éªŒè¯ V1/V2 ä½¿ç”¨ç›¸åŒæ•°æ®æºå’Œæ—¥æœŸåˆ‡ç‰‡

### Phase 1: V2 æ¡†æ¶å•æ ‡çš„å›æµ‹éªŒè¯

**ç›®æ ‡**: éªŒè¯ V2 æ¡†æ¶çš„**å•æ ‡çš„å›æµ‹åŠŸèƒ½**èƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œ

> âš ï¸ æ³¨æ„ï¼šå½“å‰ V2 ä¸æ”¯æŒç»„åˆçº§åˆ«åŠŸèƒ½ï¼Œæœ¬é˜¶æ®µä»…éªŒè¯å•æ ‡çš„å›æµ‹

**éªŒè¯é¡¹**:
1. [ ] æ•°æ®åŠ è½½å’ŒæµåŠ¨æ€§è¿‡æ»¤
2. [ ] ç­–ç•¥ä¿¡å·ç”Ÿæˆï¼ˆKAMA/MACDï¼‰
3. [ ] ATR æ­¢æŸå’Œæ—¶é—´æ­¢æŸ
4. [ ] Loss Protection è¿ç»­æ­¢æŸä¿æŠ¤
5. [ ] å•æ ‡çš„å›æµ‹æ‰§è¡Œ
6. [ ] ç»Ÿè®¡æŒ‡æ ‡è¾“å‡º
7. [ ] âš ï¸ **ADX è¿‡æ»¤å™¨**: ç¦ç”¨æˆ–ç¡®è®¤ V2 å®ç°æ­£ç¡®ï¼ˆè§ Section 5.4ï¼‰

**æ‰§è¡Œæ–¹æ³•**:
- é€‰å– 3-5 åªä»£è¡¨æ€§ ETFï¼ˆå¦‚ 510300.SH, 159915.SZï¼‰
- è¿è¡Œå•å‘¨æœŸï¼ˆå¦‚ 2024 å¹´ï¼‰å›æµ‹
- å¯¹æ¯” V1/V2 åœ¨ç›¸åŒé…ç½®ä¸‹çš„ç»“æœä¸€è‡´æ€§

### Phase 2: åŒæ¡†æ¶å¯¹æ¯”å®éªŒ

#### 2.1 å®éªŒçŸ©é˜µ

> âš ï¸ **å…¬å¹³å¯¹æ¯”**: å¢åŠ åŸºçº¿å¯¹ç…§ç»„ï¼Œç¡®ä¿æ€§èƒ½å·®å¼‚æ¥è‡ªæ¡†æ¶è€Œéé£æ§è®¾è®¡

| å®éªŒID | æ¡†æ¶ | ç­–ç•¥ | é£æ§ | å¸‚åœºå‘¨æœŸ | ETFæ± è¯„åˆ†æœŸ | è¯´æ˜ |
|--------|------|------|------|---------|------------|------|
| V1-KAMA-Base-Bear | V1 | KAMA | âŒ æ—  | ç†Šå¸‚ | 2019-2021 | åŸºçº¿ |
| V1-KAMA-Enhanced-Bear | V1 | KAMA | âœ… ATR+æ—¶é—´+LP | ç†Šå¸‚ | 2019-2021 | å¢å¼º |
| V1-KAMA-Base-Bull | V1 | KAMA | âŒ æ—  | ç‰›å¸‚ | 2022-2023 | åŸºçº¿ |
| V1-KAMA-Enhanced-Bull | V1 | KAMA | âœ… ATR+æ—¶é—´+LP | ç‰›å¸‚ | 2022-2023 | å¢å¼º |
| **V2-KAMA-Base-Bear** | **V2** | **KAMA** | **âŒ æ— ** | **ç†Šå¸‚** | **2019-2021** | **åŸºçº¿** |
| **V2-KAMA-Enhanced-Bear** | **V2** | **KAMA** | **âœ… ATR+æ—¶é—´+LP** | **ç†Šå¸‚** | **2019-2021** | **å¢å¼º** |
| **V2-KAMA-Base-Bull** | **V2** | **KAMA** | **âŒ æ— ** | **ç‰›å¸‚** | **2022-2023** | **åŸºçº¿** |
| **V2-KAMA-Enhanced-Bull** | **V2** | **KAMA** | **âœ… ATR+æ—¶é—´+LP** | **ç‰›å¸‚** | **2022-2023** | **å¢å¼º** |
| V1-MACD-Combined-Bear | V1 | MACD | âœ… Combined | ç†Šå¸‚ | 2019-2021 | å¯¹ç…§ |
| V1-MACD-Combined-Bull | V1 | MACD | âœ… Combined | ç‰›å¸‚ | 2022-2023 | å¯¹ç…§ |

**é£æ§é…ç½®è¯´æ˜**:
- **ATR+æ—¶é—´+LP**: ATRæ­¢æŸ(14,2.0) + æ—¶é—´æ­¢æŸ(60å¤©) + Loss Protection(3æ¬¡,10bars)
- **Combined**: Trailing Stop(5%) + Loss Protection(3æ¬¡,10bars)

#### 2.2 å¯¹æ¯”ç»´åº¦

**å½“å‰å®ç°ï¼ˆå•æ ‡çš„å›æµ‹ï¼‰**:
- V1: å¯¹æ± ä¸­æ¯åª ETF ç‹¬ç«‹å›æµ‹ï¼Œæ±‡æ€»ç»Ÿè®¡
- V2: å¯¹æ± ä¸­æ¯åª ETF ç‹¬ç«‹å›æµ‹ï¼Œæ±‡æ€»ç»Ÿè®¡ï¼ˆä¸ V1 ç›¸åŒï¼‰

**å¯¹æ¯”é‡ç‚¹**:
- ç›¸åŒé…ç½®ä¸‹ V1/V2 ç»“æœä¸€è‡´æ€§
- é£æ§å¢å¼ºï¼ˆATR/æ—¶é—´æ­¢æŸï¼‰çš„æ•ˆæœ
- ä¸åŒå¸‚åœºç¯å¢ƒä¸‹çš„è¡¨ç°å·®å¼‚

**æœªæ¥æ‰©å±•ï¼ˆä»å¾…å®ç°/ä¼˜åŒ–ï¼‰**:
- å…¨æ± åŠ¨æ€ç­›é€‰ï¼ˆä»é™æ€æ± æ‰©å±•åˆ°å…¨å¸‚åœºï¼‰
- ç»„åˆçº§å›æµ‹æ€§èƒ½ä¼˜åŒ–ï¼ˆå…¨æ± æ•°æ®è¯»å–/å¹¶è¡Œ/ç¼“å­˜ï¼‰
- ç»„åˆçº§é£æ§æ‰©å±•ï¼ˆç†”æ–­/æ›´å¤šæˆäº¤å‡è®¾/æ›´ç»†ç²’åº¦æ»‘ç‚¹æ¨¡å‹ï¼‰

---

### Phase 3: V2 ç»„åˆçº§å›æµ‹è½åœ°ä¸éªŒè¯ï¼ˆæ–°å¢ï¼‰

**ç›®æ ‡**: éªŒè¯ V2 æ¡†æ¶çš„**ç»„åˆçº§å›æµ‹**èƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œå¹¶äº§å‡ºå¯åˆ†æç»“æœï¼ˆTopN/ç¼“å†²/ç°‡é™é¢/æ³¢åŠ¨ç‡å€’æ•°ä»“ä½ï¼‰

**å®ç°ä½ç½®**:
- Runner: `etf_trend_following_v2/src/portfolio_backtest_runner.py`
- è„šæœ¬å…¥å£: `etf_trend_following_v2/scripts/run_backtest.sh`
- å•æµ‹: `etf_trend_following_v2/tests/test_portfolio_backtest_runner.py`

**éªŒæ”¶é¡¹ï¼ˆâœ… å·²å®Œæˆï¼‰**:
1. [x] ç»„åˆçº§æ¨¡æ‹Ÿï¼šTopN + ç¼“å†²å¸¦ï¼ˆhold_until_rankï¼‰ + åˆ†ç°‡é™é¢ + æ³¢åŠ¨ç‡å€’æ•°ä»“ä½
2. [x] æˆæœ¬æ¨¡å‹ï¼šcommission(ä¸‡ä¸‰/æœ€å°5å…ƒ) + å›ºå®šæ»‘ç‚¹(bps)
3. [x] è¾“å‡ºè½ç›˜ï¼š`equity_curve.csv` / `trades.csv` / `positions.csv` / `cluster_exposure.csv` / `performance_summary.json`
4. [x] å•æµ‹ï¼š`conda run -n backtesting pytest -q etf_trend_following_v2/tests/test_portfolio_backtest_runner.py`
5. [x] Smoke è¿è¡Œï¼š`./etf_trend_following_v2/scripts/run_backtest.sh --start-date 2024-01-02 --end-date 2024-03-29 --output-dir etf_trend_following_v2/output/portfolio_backtest_smoke4`

## 4. é¢„æœŸäº§å‡º

### 4.1 ç›®å½•ç»“æ„

```
experiment/etf/v2_vs_v1_comparison/
â”œâ”€â”€ EXPERIMENT_DESIGN.md               # æœ¬æ–‡æ¡£
â”œâ”€â”€ RESULTS.md                         # æœ€ç»ˆç»“æœæŠ¥å‘Š
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ run_phase0_setup.py            # Phase 0 å‰ç½®å‡†å¤‡è„šæœ¬
â”‚   â”œâ”€â”€ run_phase1_validation.py       # Phase 1 éªŒè¯è„šæœ¬
â”‚   â”œâ”€â”€ run_v1_backtest.py             # V1 æ¡†æ¶å›æµ‹è„šæœ¬
â”‚   â”œâ”€â”€ run_v2_backtest.py             # V2 æ¡†æ¶å›æµ‹è„šæœ¬
â”‚   â”œâ”€â”€ generate_etf_pool.py           # ETF æ± ç”Ÿæˆè„šæœ¬ï¼ˆæ”¯æŒä¸åŒè¯„åˆ†æœŸï¼‰
â”‚   â””â”€â”€ analyze_results.py             # ç»“æœåˆ†æè„šæœ¬ï¼ˆå«æ»‘ç‚¹æ•æ„Ÿæ€§ï¼‰
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ v1_kama_baseline.json          # V1 KAMA åŸºçº¿é…ç½®ï¼ˆæ— é£æ§ï¼‰
â”‚   â”œâ”€â”€ v1_kama_enhanced.json          # V1 KAMA å¢å¼ºé…ç½®ï¼ˆå¯ç”¨é£æ§ï¼‰
â”‚   â”œâ”€â”€ v1_macd_combined.json          # V1 MACD Combined é…ç½®
â”‚   â”œâ”€â”€ v2_kama_baseline.json          # V2 KAMA åŸºçº¿é…ç½®ï¼ˆæ— é£æ§ï¼‰
â”‚   â”œâ”€â”€ v2_kama_enhanced.json          # V2 KAMA å¢å¼ºé…ç½®ï¼ˆå¯ç”¨é£æ§ï¼‰
â”‚   â””â”€â”€ experiment_matrix.json         # å®éªŒçŸ©é˜µé…ç½®
â”œâ”€â”€ etf_pools/
â”‚   â”œâ”€â”€ pool_2019_2021.csv             # 2019-2021 è¯„åˆ†æœŸ ETF æ± ï¼ˆç†Šå¸‚æµ‹è¯•ç”¨ï¼‰
â”‚   â””â”€â”€ pool_2022_2023.csv             # 2022-2023 è¯„åˆ†æœŸ ETF æ± ï¼ˆç‰›å¸‚æµ‹è¯•ç”¨ï¼‰
â””â”€â”€ results/
    â”œâ”€â”€ phase1_validation/             # Phase 1 éªŒè¯ç»“æœ
    â”œâ”€â”€ v1_results/                    # V1 æ¡†æ¶å›æµ‹ç»“æœ
    â”‚   â”œâ”€â”€ bear_market/
    â”‚   â”‚   â”œâ”€â”€ baseline/
    â”‚   â”‚   â””â”€â”€ enhanced/
    â”‚   â””â”€â”€ bull_market/
    â”‚       â”œâ”€â”€ baseline/
    â”‚       â””â”€â”€ enhanced/
    â”œâ”€â”€ v2_results/                    # V2 æ¡†æ¶å›æµ‹ç»“æœ
    â”‚   â”œâ”€â”€ bear_market/
    â”‚   â”‚   â”œâ”€â”€ baseline/
    â”‚   â”‚   â””â”€â”€ enhanced/
    â”‚   â””â”€â”€ bull_market/
    â”‚       â”œâ”€â”€ baseline/
    â”‚       â””â”€â”€ enhanced/
    â”œâ”€â”€ comparison_summary.csv         # æ±‡æ€»å¯¹æ¯”è¡¨
    â””â”€â”€ slippage_sensitivity.csv       # æ»‘ç‚¹æ•æ„Ÿæ€§åˆ†æ
```

### 4.2 ç»“æœæŠ¥å‘Š

**æ±‡æ€»å¯¹æ¯”è¡¨ (comparison_summary.csv)**

| æ¡†æ¶ | ç­–ç•¥ | é£æ§ | å¸‚åœºå‘¨æœŸ | å¹´åŒ–æ”¶ç›Šç‡ | å¤æ™®æ¯”ç‡ | æœ€å¤§å›æ’¤ | èƒœç‡ | æ¢æ‰‹ç‡ | äº¤æ˜“æ¬¡æ•° |
|------|------|------|---------|-----------|---------|---------|------|--------|---------|
| V1 | KAMA | æ—  | ç†Šå¸‚ | ? | ? | ? | ? | ? | ? |
| V1 | KAMA | ATR+æ—¶é—´+LP | ç†Šå¸‚ | ? | ? | ? | ? | ? | ? |
| V1 | KAMA | æ—  | ç‰›å¸‚ | ? | ? | ? | ? | ? | ? |
| V1 | KAMA | ATR+æ—¶é—´+LP | ç‰›å¸‚ | ? | ? | ? | ? | ? | ? |
| **V2** | **KAMA** | **æ— ** | **ç†Šå¸‚** | ? | ? | ? | ? | ? | ? |
| **V2** | **KAMA** | **ATR+æ—¶é—´+LP** | **ç†Šå¸‚** | ? | ? | ? | ? | ? | ? |
| **V2** | **KAMA** | **æ— ** | **ç‰›å¸‚** | ? | ? | ? | ? | ? | ? |
| **V2** | **KAMA** | **ATR+æ—¶é—´+LP** | **ç‰›å¸‚** | ? | ? | ? | ? | ? | ? |
| V1 | MACD | Combined | ç†Šå¸‚ | ? | ? | ? | ? | ? | ? |
| V1 | MACD | Combined | ç‰›å¸‚ | ? | ? | ? | ? | ? | ? |

**æ»‘ç‚¹æ•æ„Ÿæ€§åˆ†æ (slippage_sensitivity.csv)**

| æ¡†æ¶ | ç­–ç•¥ | é£æ§ | å¸‚åœºå‘¨æœŸ | æ»‘ç‚¹(bps) | å¹´åŒ–æ”¶ç›Šç‡ | æ”¶ç›Šå˜åŒ– |
|------|------|------|---------|-----------|-----------|---------|
| V2 | KAMA | ATR+æ—¶é—´+LP | ç‰›å¸‚ | 0 | ? | baseline |
| V2 | KAMA | ATR+æ—¶é—´+LP | ç‰›å¸‚ | 5 | ? | ? |
| V2 | KAMA | ATR+æ—¶é—´+LP | ç‰›å¸‚ | 10 | ? | ? |

**å•æ ‡çš„æ˜ç»† (æ¯ä¸ª ETF çš„æŒ‡æ ‡)**

V1 å’Œ V2 å‡è¾“å‡ºå•æ ‡çš„æ˜ç»†ï¼ˆå½“å‰å‡ä¸ºå•æ ‡çš„å›æµ‹ï¼‰ã€‚

---

## 5. å…³é”®éªŒè¯ç‚¹

### 5.1 V2 æ¡†æ¶åŠŸèƒ½éªŒè¯

æ ¹æ®éœ€æ±‚æ–‡æ¡£ Section 16.4ï¼Œå½“å‰ V2 äºŒæœŸå·²å®Œæˆï¼š
- âœ… Baseline MACD/KAMA ç­–ç•¥
- âœ… Trailing Stop åŠŸèƒ½
- âœ… Loss Protection åŠŸèƒ½
- âœ… ADX è¿‡æ»¤å™¨ï¼ˆV2 å®ç°æ­£ç¡®ï¼Œè§ 5.4ï¼‰

**ç»„åˆçº§å›æµ‹çŠ¶æ€ï¼ˆâœ… å·²è½åœ°ï¼‰**:
- âœ… åŠ¨æ€ä»“ä½åˆ†é…ï¼ˆæ³¢åŠ¨ç‡å€’æ•°åŠ æƒï¼‰
- âœ… ç°‡é™åˆ¶ï¼ˆæ¯ç°‡æœ€å¤š 2 åªï¼‰
- âœ… åŠ¨é‡æ’åé€‰ä¼˜ï¼ˆTop N / ç¼“å†²å¸¦ï¼‰

### 5.2 æ•°æ®ä¸€è‡´æ€§

- V1 å’Œ V2 ä½¿ç”¨ç›¸åŒçš„æ•°æ®æºï¼š`data/chinese_etf/daily/etf/`
- å¤æƒå› å­å¤„ç†ä¸€è‡´
- æ—¥æœŸåˆ‡ç‰‡èŒƒå›´ä¸€è‡´
- **ETF æ± ä¸€è‡´**: V1/V2 ä½¿ç”¨ç›¸åŒçš„ ETF æ± è¿›è¡Œå¯¹æ¯”

### 5.3 å…¬å¹³å¯¹æ¯”åŸåˆ™

- V1 å’Œ V2 ä½¿ç”¨**ç›¸åŒçš„é£æ§é…ç½®**è¿›è¡Œå¯¹æ¯”ï¼ˆåŸºçº¿ vs åŸºçº¿ï¼Œå¢å¼º vs å¢å¼ºï¼‰
- äº¤æ˜“æˆæœ¬ä¸€è‡´ï¼šcommission=0.0003ï¼ˆä¸‡ä¸‰ï¼‰
- æ»‘ç‚¹å‡è®¾ä¸€è‡´ï¼šé»˜è®¤ 5 bpsï¼Œæ•æ„Ÿæ€§æµ‹è¯• 0/5/10 bps

### 5.4 ADX è¿‡æ»¤å™¨ Bug è­¦å‘Š

> âš ï¸ **é‡è¦**: æ ¹æ®éœ€æ±‚æ–‡æ¡£ Section 16.5 P0-5 çš„åˆ†æï¼Œç°æœ‰ V1 ç­–ç•¥çš„ ADX è¿‡æ»¤å™¨å­˜åœ¨ bugï¼Œ**å®é™…ä¸Šå®Œå…¨ä¸èµ·ä½œç”¨**ã€‚

**æ ¹å› åˆ†æ**ï¼ˆæ¥è‡ª `etf_trend_following_v2/tests/ADX_FILTER_ROOT_CAUSE_ANALYSIS.md`ï¼‰:
- ç°æœ‰ç­–ç•¥ `strategies/filters/trend_filters.py` çš„ `ADXFilter.filter_signal()` åœ¨å›æµ‹æ—¶åŠ¨æ€è®¡ç®— ADX
- ç”±äº pandas Series ç´¢å¼•å¯¹é½é—®é¢˜ï¼Œ`adx.iloc[-1]` å§‹ç»ˆè¿”å› NaN
- å¯¼è‡´ ADX è¿‡æ»¤å™¨**å®é™…ä¸Šå®Œå…¨ä¸èµ·ä½œç”¨**

**éªŒè¯æ•°æ®**: 510300.SH å›æµ‹ï¼ŒV2 æ­£ç¡®è¿‡æ»¤ 3/20 ä¸ªå¼±è¶‹åŠ¿ä¿¡å·ï¼ˆADX<25ï¼‰ï¼ŒV1 è¿‡æ»¤ 0/20

**æœ¬å®éªŒå¤„ç†æ–¹æ¡ˆ**:
1. **V1 å¯¹ç…§ç»„**: âŒ **ç¦ç”¨ ADX è¿‡æ»¤å™¨**ï¼Œé¿å…è¢«éšè— bug æ±¡æŸ“ç»“è®º
2. **V2 å®éªŒç»„**: å¯é€‰æ‹©å¯ç”¨ ADX è¿‡æ»¤å™¨ï¼ˆV2 å®ç°æ­£ç¡®ï¼‰
3. **å•ç‹¬éªŒè¯**: å¦‚éœ€éªŒè¯ ADX æ•ˆæœï¼Œä½¿ç”¨ V2 æ¡†æ¶è¿›è¡Œç‹¬ç«‹å®éªŒ

---

## 6. å®¡é˜…æ¸…å•

### 6.1 å·²ä¿®å¤é—®é¢˜ï¼ˆv3.0/v4.0 ä¿®è®¢ï¼‰

| é—®é¢˜ | åŸçŠ¶æ€ | ä¿®å¤æ–¹æ¡ˆ | çŠ¶æ€ |
|------|--------|---------|------|
| V2 å®šä½ä¸å®é™…èƒ½åŠ›ä¸ç¬¦ | æè¿°ä¸º"å…¨æ± åŠ¨æ€+ç»„åˆçº§å›æµ‹" | v3.0 æ˜ç¡®å½“æ—¶ä¸ºå•æ ‡å›æµ‹ï¼›v4.0 ç»„åˆçº§å›æµ‹å·²è½åœ°ï¼ˆä»ä¸ºé™æ€æ± ï¼Œéå…¨æ± åŠ¨æ€ï¼‰ | âœ… å·²ä¿®å¤ |
| æµåŠ¨æ€§é˜ˆå€¼é…ç½®ä¸ä¸€è‡´ | æ–‡æ¡£æ¨è500ä¸‡/50ä¸‡ï¼Œé…ç½®ä¸º100ä¸‡/100ä¸‡ | ç»Ÿä¸€ä¸º500ä¸‡/50ä¸‡å¹¶æ›´æ–° `example_config.json` | âœ… å·²ä¿®å¤ |
| V1 ç†Šå¸‚æµ‹è¯•å‰è§†åå·® | 2022-2023è¯„åˆ†æœŸ + 2022-2023æµ‹è¯•æœŸ | ç†Šå¸‚ä½¿ç”¨2019-2021è¯„åˆ†æœŸ | âœ… å·²ä¿®å¤ |
| V1/V2 é£æ§é…ç½®ä¸å¯¹ç§° | V1æ— é£æ§ï¼ŒV2é»˜è®¤å¯ç”¨ATR/æ—¶é—´æ­¢æŸ | å¢åŠ åŸºçº¿å¯¹ç…§ç»„ï¼Œåˆ†å±‚å¯¹æ¯” | âœ… å·²ä¿®å¤ |
| ADX è¿‡æ»¤å™¨ bug è­¦å‘Š | æœªè¯´æ˜ V1 ADX bug | æ˜ç¡®ç¦ç”¨ V1 ADXï¼Œå•ç‹¬è¯´æ˜å¤„ç†æ–¹æ¡ˆ | âœ… å·²ä¿®å¤ |
| ç¼ºå°‘æˆæœ¬æ•æ„Ÿæ€§æŒ‡æ ‡ | æ— æ¢æ‰‹ç‡/æ»‘ç‚¹åˆ†æ | æ·»åŠ æ¢æ‰‹ç‡ã€äº¤æ˜“æ¬¡æ•°ã€æ»‘ç‚¹æ•æ„Ÿæ€§æŒ‡æ ‡ | âœ… å·²ä¿®å¤ |
| è„šæœ¬/é…ç½®éª¨æ¶ä¸å®Œæ•´ | ä»…æœ‰ç›®å½•ç»“æ„ | æ·»åŠ  Phase 0 å‰ç½®å‡†å¤‡ä»»åŠ¡ | âœ… å·²ä¿®å¤ |

### 6.2 å¾…ç¡®è®¤äº‹é¡¹

è¯·å®¡é˜…ä»¥ä¸‹å†…å®¹å¹¶ç¡®è®¤ï¼š

- [ ] V2 ç»„åˆçº§å›æµ‹ï¼ˆTopN/ç°‡é™é¢/ä»“ä½ï¼‰è½åœ°åçš„å®éªŒèŒƒå›´æ˜¯å¦éœ€è¦æ‰©å±•åˆ° Phase 3ï¼Ÿ
- [ ] ç†Šå¸‚ä½¿ç”¨ 2019-2021 è¯„åˆ†æœŸæ˜¯å¦å¯è¡Œï¼ˆéœ€ç¡®è®¤æ•°æ®å¯ç”¨æ€§ï¼‰ï¼Ÿ
- [ ] V1/V2 åŸºçº¿å¯¹ç…§ç»„çš„é£æ§é…ç½®æ˜¯å¦å¯¹ç§°ï¼Ÿ
- [ ] ADX è¿‡æ»¤å™¨åœ¨ V1 ä¸­ç¦ç”¨çš„å¤„ç†æ–¹æ¡ˆæ˜¯å¦åˆé€‚ï¼Ÿ
- [ ] æ¢æ‰‹ç‡/æ»‘ç‚¹æ•æ„Ÿæ€§æŒ‡æ ‡æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Ÿ

---

## 7. å‚è€ƒæ–‡æ¡£

- éœ€æ±‚æ–‡æ¡£: `requirement_docs/20251211_etf_trend_following_v2_requirement.md`
  - Section 16.4: V2 å·²çŸ¥é—®é¢˜ä¸é™åˆ¶ï¼ˆå•æ ‡çš„å›æµ‹çº¦æŸï¼‰
  - Section 16.5 P0-5: ADX è¿‡æ»¤å™¨ bug åˆ†æ
- Gemini è®¨è®º: `requirement_docs/20251210_trend_follow_pool_discussion_with_gemini.md`
- V1 æœ€ä¼˜é…ç½®: `experiment/etf/selector_score/results/`
- ADX Bug åˆ†æ: `etf_trend_following_v2/tests/ADX_FILTER_ROOT_CAUSE_ANALYSIS.md`
- V2 é…ç½®ç¤ºä¾‹: `etf_trend_following_v2/config/example_config.json`

---

## 8. å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|---------|
| v1.0 | 2025-12-12 | åˆå§‹ç‰ˆæœ¬ |
| v2.0 | 2025-12-12 | æ·»åŠ  V2 æ¡†æ¶è¯¦ç»†é…ç½® |
| **v3.0** | **2025-12-13** | **æ ¹æ®å®¡æ ¸å»ºè®®ä¿®è®¢**: ä¿®å¤ V2 å®šä½ã€å‰è§†åå·®ã€é£æ§ä¸å¯¹ç§°ã€ADX bug è­¦å‘Šç­‰é—®é¢˜ï¼›æ·»åŠ æˆæœ¬æ•æ„Ÿæ€§æŒ‡æ ‡å’Œ Phase 0 å‰ç½®å‡†å¤‡ |
| **v4.0** | **2025-12-13** | **ç»„åˆçº§å›æµ‹è½åœ°**: å¢åŠ  `PortfolioBacktestRunner`ï¼ˆTopN/ç¼“å†²/ç°‡é™é¢/æ³¢åŠ¨ç‡å€’æ•°ä»“ä½ï¼‰ï¼›è¡¥å…… Phase 3 éªŒæ”¶é¡¹ä¸ smoke è¿è¡Œå‘½ä»¤ï¼›æ›´æ–°æ–‡æ¡£çº¦æŸå£°æ˜ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v4.0
**ä½œè€…**: Claude Code
**å®¡é˜…çŠ¶æ€**: å·²å®¡é˜…ä¿®è®¢
