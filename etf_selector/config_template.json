{
  "$schema": "etf_selector_config_schema",
  "version": "2.0",
  "description": "ETF Selector 完整配置文件模板 - 支持三级筛选全流程超参数配置",

  "基础配置": {
    "data_dir": "data/chinese_etf",
    "output_dir": "results/selector",
    "output_filename": "trend_etf_pool.csv",
    "verbose": true,
    "with_analysis": false
  },

  "时间范围": {
    "start_date": null,
    "end_date": null,
    "注释": "格式: YYYY-MM-DD, null表示使用全部历史数据"
  },

  "第一级_初筛参数": {
    "min_turnover": 50000000,
    "min_listing_days": 180,
    "turnover_lookback_days": 30,
    "注释": {
      "min_turnover": "最小日均成交额（元），默认5000万（0.5亿）",
      "min_listing_days": "最小上市天数，默认180天（约6个月）",
      "turnover_lookback_days": "计算日均成交额的回看天数"
    }
  },

  "第二级_核心筛选参数": {
    "ADX趋势强度": {
      "adx_period": 14,
      "adx_lookback_days": 250,
      "adx_percentile": 80,
      "注释": {
        "adx_period": "ADX计算周期",
        "adx_lookback_days": "ADX均值计算窗口（交易日）",
        "adx_percentile": "ADX排名百分位，保留前(100-percentile)%，默认80即保留前20%"
      }
    },

    "双均线回测过滤": {
      "enable_ma_backtest_filter": false,
      "ma_short": 20,
      "ma_long": 50,
      "ret_dd_percentile": 70,
      "注释": {
        "enable_ma_backtest_filter": "是否启用双均线回测过滤（默认禁用）",
        "ma_short": "双均线短周期",
        "ma_long": "双均线长周期",
        "ret_dd_percentile": "收益回撤比排名百分位，保留前(100-percentile)%，默认70即保留前30%"
      }
    },

    "波动率过滤": {
      "min_volatility": 0.20,
      "max_volatility": 0.60,
      "volatility_lookback_days": 252,
      "注释": {
        "min_volatility": "最小年化波动率（0.20 = 20%）",
        "max_volatility": "最大年化波动率（0.60 = 60%）",
        "volatility_lookback_days": "波动率计算窗口（交易日）"
      }
    },

    "动量过滤": {
      "momentum_periods": [63, 252],
      "momentum_min_positive": true,
      "注释": {
        "momentum_periods": "动量计算周期列表（交易日），[63, 252]对应3个月和12个月",
        "momentum_min_positive": "true=仅要求动量>0，false=按动量排名筛选"
      }
    },

    "筛选模式控制": {
      "skip_stage2_percentile_filtering": true,
      "skip_stage2_range_filtering": true,
      "注释": {
        "skip_stage2_percentile_filtering": "是否跳过第二级的百分位筛选（ADX、收益回撤比），直接按评分排序返回topN",
        "skip_stage2_range_filtering": "是否跳过第二级的范围过滤（波动率、动量），仅在动态轮换场景下启用"
      }
    }
  },

  "无偏评分系统": {
    "enable_unbiased_scoring": true,
    "score_mode": "legacy",
    "注释": {
      "enable_unbiased_scoring": "是否启用无偏评分系统",
      "score_mode": "可选值: 'optimized'（新公式，超额收益/R²/量能）或 'legacy'（旧版，ADX+趋势+效率+流动性+3M/12M动量）"
    }
  },

  "评分指标窗口参数": {
    "基准设置": {
      "benchmark_ts_code": "510300.SH",
      "注释": "基准指数或ETF，用于计算超额收益，默认沪深300ETF"
    },

    "超额收益窗口": {
      "excess_return_short_window": 20,
      "excess_return_long_window": 60,
      "注释": {
        "excess_return_short_window": "短期超额收益窗口（交易日），默认20日约1个月",
        "excess_return_long_window": "中期超额收益窗口（交易日），默认60日约3个月"
      }
    },

    "趋势质量窗口": {
      "trend_quality_window": 60,
      "trend_consistency_window": 63,
      "price_efficiency_window": 252,
      "注释": {
        "trend_quality_window": "趋势质量R²回归窗口（交易日）",
        "trend_consistency_window": "趋势一致性计算窗口（交易日），约3个月",
        "price_efficiency_window": "价格效率计算窗口（交易日），约1年"
      }
    },

    "资金动能窗口": {
      "volume_short_window": 20,
      "volume_long_window": 60,
      "注释": {
        "volume_short_window": "成交量短均窗口（交易日）",
        "volume_long_window": "成交量长均窗口（交易日）"
      }
    },

    "流动性评分": {
      "liquidity_score_window": 30,
      "注释": "流动性评分计算窗口（交易日）"
    }
  },

  "评分权重配置": {
    "V2优化版权重": {
      "core_trend_weight": 0.40,
      "trend_quality_weight": 0.35,
      "strength_weight": 0.15,
      "volume_weight": 0.10,
      "注释": {
        "core_trend_weight": "核心趋势（超额收益）权重，默认40%",
        "trend_quality_weight": "趋势质量（R²）权重，默认35%",
        "strength_weight": "ADX趋势强度权重，默认15%",
        "volume_weight": "资金动能权重，默认10%",
        "验证": "四项之和必须等于1.0"
      }
    },

    "核心趋势子权重": {
      "excess_return_20d_weight": 0.40,
      "excess_return_60d_weight": 0.60,
      "注释": {
        "excess_return_20d_weight": "20日超额收益权重，默认40%",
        "excess_return_60d_weight": "60日超额收益权重，默认60%",
        "验证": "两项之和必须等于1.0"
      }
    },

    "V1旧版权重_仅legacy模式生效": {
      "primary_weight": 0.80,
      "secondary_weight": 0.20,
      "adx_score_weight": 0.40,
      "trend_consistency_weight": 0.30,
      "price_efficiency_weight": 0.20,
      "liquidity_score_weight": 0.10,
      "momentum_3m_score_weight": 0.30,
      "momentum_12m_score_weight": 0.70,
      "注释": "V1旧版权重配置，仅在score_mode='legacy'时生效，已弃用但保留兼容性"
    }
  },

  "第三级_分散化优化参数": {
    "基础参数": {
      "target_portfolio_size": 20,
      "max_correlation": 0.7,
      "min_industries": 3,
      "注释": {
        "target_portfolio_size": "目标组合数量",
        "max_correlation": "最大相关系数阈值，组合内ETF相关性应低于此值",
        "min_industries": "最少行业数量要求"
      }
    },

    "智能去重参数": {
      "enable_deduplication": true,
      "dedup_min_ratio": 0.8,
      "dedup_thresholds": [0.98, 0.95, 0.92, 0.90],
      "注释": {
        "enable_deduplication": "是否启用智能去重功能",
        "dedup_min_ratio": "去重后最小保留比例（0.8 = 80%）",
        "dedup_thresholds": "去重相关性阈值序列，从严到松逐级尝试"
      }
    },

    "V2分散逻辑参数": {
      "diversify_v2": false,
      "score_diff_threshold": 0.05,
      "注释": {
        "diversify_v2": "是否启用V2分散逻辑（P0: max pairwise相关性, P1: Score优先去重）",
        "score_diff_threshold": "去重时Score差异阈值（0.05 = 5%），超过此差异则无条件保留高分者"
      }
    },

    "行业平衡": {
      "balance_industries": true,
      "注释": "是否在最终组合中平衡行业分布"
    }
  },

  "行业分类关键词": {
    "注释": "基于名称关键词的行业分类规则",
    "keywords": {
      "科技": ["科技", "半导体", "芯片", "软件", "人工智能", "AI", "5G", "互联网", "通信"],
      "医药": ["医药", "医疗", "生物", "健康", "制药", "CXO"],
      "金融": ["金融", "银行", "证券", "保险", "券商"],
      "消费": ["消费", "食品", "白酒", "零售", "商业", "餐饮"],
      "新能源": ["新能源", "光伏", "储能", "锂电", "电池", "风电"],
      "军工": ["军工", "国防", "航空", "航天"],
      "地产": ["地产", "房地产", "建筑", "基建"],
      "周期": ["煤炭", "有色", "钢铁", "化工", "石油", "石化"],
      "制造": ["机械", "设备", "汽车", "制造"]
    }
  },

  "预设配置模板": {
    "注释": "提供几个常用场景的预设配置，可直接引用",

    "conservative": {
      "描述": "保守配置：高流动性、低波动、严格去重",
      "min_turnover": 100000000,
      "min_volatility": 0.15,
      "max_volatility": 0.40,
      "max_correlation": 0.6,
      "diversify_v2": true
    },

    "aggressive": {
      "描述": "激进配置：低流动性门槛、高波动、Score优先",
      "min_turnover": 20000000,
      "min_volatility": 0.25,
      "max_volatility": 0.80,
      "score_diff_threshold": 0.10,
      "diversify_v2": true
    },

    "balanced": {
      "描述": "平衡配置：默认参数的均衡组合",
      "min_turnover": 50000000,
      "min_volatility": 0.20,
      "max_volatility": 0.60,
      "max_correlation": 0.7,
      "diversify_v2": false
    }
  }
}
