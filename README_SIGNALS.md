# æ¯æ—¥äº¤æ˜“ä¿¡å·ç”Ÿæˆç³»ç»Ÿ

## åŠŸèƒ½æ¦‚è¿°

æ¯æ—¥äº¤æ˜“ä¿¡å·ç”Ÿæˆç³»ç»Ÿå¸®åŠ©æ‚¨åœ¨æ¯å¤©æ”¶ç›˜åï¼Œæ ¹æ®åŒå‡çº¿ç­–ç•¥ï¼ˆæˆ–å…¶ä»–ç­–ç•¥ï¼‰è‡ªåŠ¨åˆ†æè‚¡ç¥¨æ± ä¸­çš„æ‰€æœ‰æ ‡çš„ï¼Œç”Ÿæˆä¹°å…¥/å–å‡ºä¿¡å·å’Œèµ„é‡‘åˆ†é…å»ºè®®ã€‚

## æ ¸å¿ƒæ–‡ä»¶

- `generate_signals.py` - Pythonä¿¡å·ç”Ÿæˆè„šæœ¬
- `generate_daily_signals.sh` - Shellå¯åŠ¨è„šæœ¬ï¼ˆæ¨èä½¿ç”¨ï¼‰

## å¿«é€Ÿå¼€å§‹

### 1. æ¯å¤©æ”¶ç›˜åç”Ÿæˆäº¤æ˜“ä¿¡å·

```bash
# åŸºç¡€ç”¨æ³•
./generate_daily_signals.sh --stock-list results/trend_etf_pool_20251107.csv

# æŒ‡å®šå¯ç”¨èµ„é‡‘å’Œç›®æ ‡æŒä»“æ•°
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --cash 200000 \
  --positions 10

# ä¿å­˜æŠ¥å‘Šåˆ°æ–‡ä»¶
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --output signals/daily_$(date +%Y%m%d).txt \
  --csv signals/signals_$(date +%Y%m%d).csv
```

### 2. ä½¿ç”¨è‡ªå®šä¹‰ç­–ç•¥å‚æ•°

```bash
# ä½¿ç”¨çŸ­æœŸ5æ—¥å‡çº¿å’Œé•¿æœŸ20æ—¥å‡çº¿
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --n1 5 \
  --n2 20

# æ³¨æ„ï¼šç­–ç•¥å‚æ•°å¿…é¡»ä¸å›æµ‹æ—¶ä½¿ç”¨çš„å‚æ•°ä¸€è‡´ï¼
```

## å·¥ä½œæµç¨‹

### æ—¥å¸¸æ“ä½œæµç¨‹

1. **æ¯å¤©15:30å** - ç­‰å¾…å¸‚åœºæ”¶ç›˜ï¼Œè·å–æœ€æ–°æ•°æ®
2. **æ›´æ–°æ•°æ®** - ç¡®ä¿æ•°æ®å·²æ›´æ–°åˆ°å½“å¤©
3. **è¿è¡Œä¿¡å·ç”Ÿæˆ**:
   ```bash
   ./generate_daily_signals.sh \
     --stock-list results/trend_etf_pool_20251107.csv \
     --cash 100000 \
     --positions 10
   ```
4. **æŸ¥çœ‹æŠ¥å‘Š** - æ£€æŸ¥ä¹°å…¥/å–å‡ºä¿¡å·
5. **æ‰§è¡Œäº¤æ˜“** - æ ¹æ®å»ºè®®åœ¨è¯åˆ¸è´¦æˆ·ä¸­ä¸‹å•

### ä¿¡å·ç±»å‹è¯´æ˜

- **BUYï¼ˆä¹°å…¥ï¼‰** - é‡‘å‰ä¿¡å·ï¼ŒçŸ­æœŸå‡çº¿ä¸Šç©¿é•¿æœŸå‡çº¿
- **SELLï¼ˆå–å‡ºï¼‰** - æ­»å‰ä¿¡å·ï¼ŒçŸ­æœŸå‡çº¿ä¸‹ç©¿é•¿æœŸå‡çº¿
- **HOLD_LONGï¼ˆæŒæœ‰å¤šå¤´ï¼‰** - çŸ­æœŸå‡çº¿åœ¨é•¿æœŸå‡çº¿ä¸Šæ–¹ï¼Œç»§ç»­æŒæœ‰
- **HOLD_SHORTï¼ˆæŒæœ‰ç©ºå¤´ï¼‰** - çŸ­æœŸå‡çº¿åœ¨é•¿æœŸå‡çº¿ä¸‹æ–¹ï¼Œä¸å»ºè®®ä¹°å…¥

## è¾“å‡ºç¤ºä¾‹

```
================================================================================
äº¤æ˜“ä¿¡å·æŠ¥å‘Š - 2025-11-07 15:35:20
================================================================================

ğŸ“Š ä¿¡å·ç»Ÿè®¡
--------------------------------------------------------------------------------
  BUY: 3 åª
  HOLD_LONG: 15 åª
  HOLD_SHORT: 82 åª

ğŸ”” ä¹°å…¥ä¿¡å·ï¼ˆé‡‘å‰ï¼‰
--------------------------------------------------------------------------------
  588170.SH
    å½“å‰ä»·æ ¼: Â¥1.234
    çŸ­æœŸå‡çº¿: 1.235
    é•¿æœŸå‡çº¿: 1.220
    ä¿¡å·å¼ºåº¦: 1.23%
    è¯´æ˜: é‡‘å‰ä¹°å…¥ä¿¡å·ï¼çŸ­æœŸå‡çº¿(10æ—¥)ä¸Šç©¿é•¿æœŸå‡çº¿(20æ—¥)

  589010.SH
    å½“å‰ä»·æ ¼: Â¥2.567
    çŸ­æœŸå‡çº¿: 2.570
    é•¿æœŸå‡çº¿: 2.550
    ä¿¡å·å¼ºåº¦: 0.78%
    è¯´æ˜: é‡‘å‰ä¹°å…¥ä¿¡å·ï¼çŸ­æœŸå‡çº¿(10æ—¥)ä¸Šç©¿é•¿æœŸå‡çº¿(20æ—¥)

ğŸ’° èµ„é‡‘åˆ†é…å»ºè®®
--------------------------------------------------------------------------------
  æ€»èµ„é‡‘: Â¥100,000.00
  åˆ†é…èµ„é‡‘: Â¥98,500.00
  å‰©ä½™èµ„é‡‘: Â¥1,500.00
  å»ºè®®æŒä»“æ•°: 3

  å…·ä½“ä¹°å…¥å»ºè®®:

  [1] 588170.SH
      ä¹°å…¥ä»·æ ¼: Â¥1.23
      ä¹°å…¥æ•°é‡: 26500 è‚¡
      é¢„è®¡æˆæœ¬: Â¥32,595.00
      ä»“ä½å æ¯”: 32.60%
      ä¿¡å·å¼ºåº¦: 1.23%

  [2] 589010.SH
      ä¹°å…¥ä»·æ ¼: Â¥2.57
      ä¹°å…¥æ•°é‡: 12800 è‚¡
      é¢„è®¡æˆæœ¬: Â¥32,896.00
      ä»“ä½å æ¯”: 32.90%
      ä¿¡å·å¼ºåº¦: 0.78%

  [3] 159366.SZ
      ä¹°å…¥ä»·æ ¼: Â¥3.45
      ä¹°å…¥æ•°é‡: 9500 è‚¡
      é¢„è®¡æˆæœ¬: Â¥32,775.00
      ä»“ä½å æ¯”: 32.78%
      ä¿¡å·å¼ºåº¦: 0.56%
```

## å‚æ•°è¯´æ˜

### å¿…éœ€å‚æ•°

- `--stock-list` - è‚¡ç¥¨åˆ—è¡¨CSVæ–‡ä»¶ï¼ˆå¿…é¡»åŒ…å«ts_codeåˆ—ï¼‰

### å¯é€‰å‚æ•°

- `--strategy` - ç­–ç•¥åç§°ï¼ˆé»˜è®¤: sma_crossï¼‰
- `--cash` - å¯ç”¨èµ„é‡‘ï¼ˆé»˜è®¤: 100000ï¼‰
- `--positions` - ç›®æ ‡æŒä»“æ•°é‡ï¼ˆé»˜è®¤: 10ï¼‰
- `--cost-model` - è´¹ç”¨æ¨¡å‹ï¼ˆé»˜è®¤: cn_etfï¼‰
- `--data-dir` - æ•°æ®ç›®å½•ï¼ˆé»˜è®¤: data/csv/dailyï¼‰
- `--lookback-days` - å›çœ‹å¤©æ•°ï¼ˆé»˜è®¤: 250ï¼‰
- `--output` - æŠ¥å‘Šè¾“å‡ºæ–‡ä»¶è·¯å¾„
- `--csv` - CSVæ•°æ®è¾“å‡ºè·¯å¾„
- `--n1` - çŸ­æœŸå‡çº¿å‘¨æœŸ
- `--n2` - é•¿æœŸå‡çº¿å‘¨æœŸ

### è´¹ç”¨æ¨¡å‹

- `default` - æ— è´¹ç”¨ï¼ˆ0%ä½£é‡‘ï¼Œ0%æ»‘ç‚¹ï¼‰
- `cn_etf` - ä¸­å›½ETFï¼ˆ0.01%ä½£é‡‘ï¼Œ0.01%æ»‘ç‚¹ï¼‰â­ æ¨è
- `cn_stock` - ä¸­å›½Aè‚¡ï¼ˆ0.03%ä½£é‡‘ï¼Œ0.1%æ»‘ç‚¹ï¼Œå«å°èŠ±ç¨ï¼‰
- `us_stock` - ç¾è‚¡ï¼ˆ0.1%ä½£é‡‘ï¼Œ0.05%æ»‘ç‚¹ï¼‰

## èµ„é‡‘åˆ†é…è¯´æ˜

### åˆ†é…ç­–ç•¥

ç³»ç»Ÿä½¿ç”¨**ç­‰æƒé‡åˆ†é…**ç­–ç•¥ï¼š
1. ç­›é€‰å‡ºæ‰€æœ‰"BUY"ä¿¡å·çš„æ ‡çš„
2. æŒ‰ä¿¡å·å¼ºåº¦æ’åºï¼ˆå‡çº¿å·®å€¼ç™¾åˆ†æ¯”ï¼‰
3. å–å‰Nä¸ªæ ‡çš„ï¼ˆN = `--positions`å‚æ•°ï¼‰
4. å°†å¯ç”¨èµ„é‡‘å¹³å‡åˆ†é…ç»™è¿™Nä¸ªæ ‡çš„
5. è®¡ç®—æ¯ä¸ªæ ‡çš„çš„å…·ä½“ä¹°å…¥è‚¡æ•°ï¼ˆå‘ä¸‹å–æ•´åˆ°100è‚¡çš„å€æ•°ï¼‰

### ä¹°å…¥æ•°é‡è®¡ç®—

```python
# æ¯ä¸ªæ ‡çš„åˆ†é…èµ„é‡‘
cash_per_position = total_cash / n_positions

# è€ƒè™‘æ‰‹ç»­è´¹åçš„æœ‰æ•ˆèµ„é‡‘
effective_cash = cash_per_position * (1 - commission - spread)

# å¯ä¹°å…¥è‚¡æ•°ï¼ˆå‘ä¸‹å–æ•´åˆ°100è‚¡å€æ•°ï¼‰
shares = int(effective_cash / price / 100) * 100
```

### æ³¨æ„äº‹é¡¹

1. **Aè‚¡æœ€å°äº¤æ˜“å•ä½æ˜¯100è‚¡ï¼ˆ1æ‰‹ï¼‰**ï¼Œç³»ç»Ÿè‡ªåŠ¨å‘ä¸‹å–æ•´
2. **è€ƒè™‘äº†äº¤æ˜“æˆæœ¬**ï¼ˆä½£é‡‘+æ»‘ç‚¹ï¼‰ï¼Œå®é™…ä¹°å…¥é‡‘é¢ä¼šç•¥å°äºåˆ†é…èµ„é‡‘
3. **å»ºè®®é¢„ç•™ç°é‡‘**ï¼Œä¸è¦100%æ»¡ä»“ï¼Œç³»ç»Ÿé»˜è®¤ä¿å®ˆè®¡ç®—
4. **ä¿¡å·å¼ºåº¦ä½œä¸ºå‚è€ƒ**ï¼Œå¼ºåº¦è¶Šå¤§è¡¨ç¤ºå‡çº¿ä¹–ç¦»è¶Šå¤§

## ä¸å›æµ‹ç³»ç»Ÿçš„é…åˆä½¿ç”¨

### é‡è¦ï¼šç­–ç•¥å‚æ•°ä¸€è‡´æ€§

âš ï¸ **ç¡®ä¿ä¿¡å·ç”Ÿæˆæ—¶ä½¿ç”¨çš„ç­–ç•¥å‚æ•°ä¸å›æµ‹æ—¶ä¸€è‡´ï¼**

ä¾‹å¦‚ï¼Œå¦‚æœå›æµ‹æ—¶ä½¿ç”¨çš„æ˜¯ä¼˜åŒ–åçš„å‚æ•° `n1=15, n2=50`ï¼Œé‚£ä¹ˆç”Ÿæˆä¿¡å·æ—¶ä¹Ÿå¿…é¡»ä½¿ç”¨ç›¸åŒå‚æ•°ï¼š

```bash
# å›æµ‹æ—¶ä½¿ç”¨çš„å‚æ•°
./run_backtest.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --strategy sma_cross \
  --optimize \
  --data-dir data/csv/daily

# å‡è®¾ä¼˜åŒ–åæœ€ä½³å‚æ•°æ˜¯ n1=15, n2=50

# ä¿¡å·ç”Ÿæˆæ—¶ä¹Ÿè¦ä½¿ç”¨ç›¸åŒå‚æ•°
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --strategy sma_cross \
  --n1 15 \
  --n2 50 \
  --data-dir data/csv/daily
```

### å®Œæ•´å·¥ä½œæµ

```bash
# 1. å…ˆå¯¹è‚¡ç¥¨æ± è¿›è¡Œå›æµ‹å’Œä¼˜åŒ–
./run_backtest.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --strategy sma_cross \
  --optimize \
  --data-dir data/csv/daily

# 2. æŸ¥çœ‹results/etf/statsç›®å½•ä¸‹çš„CSVæ–‡ä»¶ï¼Œæ‰¾å‡ºæœ€ä½³å‚æ•°ç»„åˆ

# 3. æ¯å¤©æ”¶ç›˜åï¼Œä½¿ç”¨ç›¸åŒå‚æ•°ç”Ÿæˆä¿¡å·
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --strategy sma_cross \
  --n1 <ä¼˜åŒ–åçš„å€¼> \
  --n2 <ä¼˜åŒ–åçš„å€¼> \
  --cash 100000 \
  --positions 10 \
  --data-dir data/csv/daily
```

## é«˜çº§ç”¨æ³•

### å®šæ—¶ä»»åŠ¡

ä½¿ç”¨cronæ¯å¤©15:30è‡ªåŠ¨è¿è¡Œï¼š

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯ä¸ªäº¤æ˜“æ—¥15:30ï¼‰
30 15 * * 1-5 cd /path/to/backtesting && ./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --output signals/daily_$(date +\%Y\%m\%d).txt \
  --csv signals/signals_$(date +\%Y\%m\%d).csv
```

### Pythonè„šæœ¬ç›´æ¥è°ƒç”¨

å¦‚æœéœ€è¦æ›´å¤šè‡ªå®šä¹‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Pythonè„šæœ¬ï¼š

```bash
/home/zijunliu/miniforge3/condabin/conda run -n backtesting \
  python generate_signals.py \
  --stock-list results/trend_etf_pool_20251107.csv \
  --cash 100000 \
  --positions 10 \
  --n1 15 \
  --n2 50 \
  --data-dir data/csv/daily
```

### ç»“åˆå…¶ä»–å·¥å…·

```bash
# ç”Ÿæˆä¿¡å·å¹¶å‘é€é‚®ä»¶é€šçŸ¥
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --output /tmp/signals.txt && \
  mail -s "ä»Šæ—¥äº¤æ˜“ä¿¡å·" your@email.com < /tmp/signals.txt

# ç”Ÿæˆä¿¡å·å¹¶ä¿å­˜åˆ°å†å²è®°å½•
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --output signals/history/$(date +%Y%m%d).txt
```

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ²¡æœ‰ä¹°å…¥ä¿¡å·ï¼Ÿ

**A:** å¯èƒ½çš„åŸå› ï¼š
1. å½“å‰æ‰€æœ‰æ ‡çš„éƒ½å¤„äºä¸‹é™è¶‹åŠ¿ï¼ˆçŸ­æœŸå‡çº¿åœ¨é•¿æœŸå‡çº¿ä¸‹æ–¹ï¼‰
2. æœ€è¿‘æ²¡æœ‰é‡‘å‰ï¼ˆå‡çº¿äº¤å‰ï¼‰å‘ç”Ÿ
3. æ•°æ®æœªæ›´æ–°åˆ°æœ€æ–°äº¤æ˜“æ—¥

### Q2: å¦‚ä½•çŸ¥é“ä½¿ç”¨å“ªä¸ªç­–ç•¥å‚æ•°ï¼Ÿ

**A:** æ­¥éª¤ï¼š
1. å…ˆç”¨ `./run_backtest.sh --optimize` å¯¹è‚¡ç¥¨æ± è¿›è¡Œä¼˜åŒ–
2. æŸ¥çœ‹å›æµ‹ç»“æœï¼Œæ‰¾å‡ºæ”¶ç›Šç‡æœ€é«˜çš„å‚æ•°ç»„åˆ
3. åœ¨ä¿¡å·ç”Ÿæˆæ—¶ä½¿ç”¨ç›¸åŒçš„å‚æ•°

### Q3: ä¿¡å·å¼ºåº¦æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

**A:** ä¿¡å·å¼ºåº¦ = (çŸ­æœŸå‡çº¿ - é•¿æœŸå‡çº¿) / é•¿æœŸå‡çº¿ * 100%
- æ­£å€¼è¡¨ç¤ºçŸ­æœŸå‡çº¿åœ¨ä¸Šæ–¹ï¼ˆå¤šå¤´ï¼‰
- è´Ÿå€¼è¡¨ç¤ºçŸ­æœŸå‡çº¿åœ¨ä¸‹æ–¹ï¼ˆç©ºå¤´ï¼‰
- ç»å¯¹å€¼è¶Šå¤§ï¼Œä¹–ç¦»è¶Šå¤§

### Q4: ä¸ºä»€ä¹ˆä¹°å…¥æ•°é‡ä¸æ˜¯æ•´æ•°åƒæˆ–ä¸‡ï¼Ÿ

**A:** ç³»ç»Ÿæ ¹æ®ä»¥ä¸‹å› ç´ è®¡ç®—ï¼š
1. å¯ç”¨èµ„é‡‘ / æŒä»“æ•° = æ¯ä¸ªæ ‡çš„åˆ†é…èµ„é‡‘
2. å‡å»äº¤æ˜“æˆæœ¬ï¼ˆä½£é‡‘+æ»‘ç‚¹ï¼‰
3. é™¤ä»¥å½“å‰ä»·æ ¼ = å¯ä¹°è‚¡æ•°
4. å‘ä¸‹å–æ•´åˆ°100è‚¡çš„å€æ•°ï¼ˆAè‚¡æœ€å°äº¤æ˜“å•ä½ï¼‰

### Q5: å¯ä»¥ç”¨äºå®ç›˜è‡ªåŠ¨äº¤æ˜“å—ï¼Ÿ

**A:** æœ¬ç³»ç»Ÿ**ä»…ç”Ÿæˆå»ºè®®**ï¼Œä¸æ‰§è¡Œå®é™…äº¤æ˜“ã€‚æ‚¨éœ€è¦ï¼š
1. æŸ¥çœ‹æ¯æ—¥ä¿¡å·æŠ¥å‘Š
2. äººå·¥å®¡æ ¸å»ºè®®
3. åœ¨è¯åˆ¸è´¦æˆ·ä¸­æ‰‹åŠ¨ä¸‹å•

âš ï¸ **é£é™©æç¤º**:
- å†å²å›æµ‹è¡¨ç°ä¸ä»£è¡¨æœªæ¥æ”¶ç›Š
- å¸‚åœºæœ‰é£é™©ï¼ŒæŠ•èµ„éœ€è°¨æ…
- å»ºè®®ä»å°èµ„é‡‘å¼€å§‹æµ‹è¯•ç­–ç•¥æœ‰æ•ˆæ€§

## æ–‡ä»¶ç»“æ„

```
backtesting/
â”œâ”€â”€ generate_signals.py          # ä¿¡å·ç”ŸæˆPythonè„šæœ¬
â”œâ”€â”€ generate_daily_signals.sh    # Shellå¯åŠ¨è„šæœ¬
â”œâ”€â”€ README_SIGNALS.md           # æœ¬æ–‡æ¡£
â”œâ”€â”€ signals/                    # ä¿¡å·è¾“å‡ºç›®å½•ï¼ˆå»ºè®®åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ daily_20251107.txt     # æ¯æ—¥æŠ¥å‘Š
â”‚   â”œâ”€â”€ signals_20251107.csv   # æ¯æ—¥ä¿¡å·CSV
â”‚   â””â”€â”€ history/               # å†å²è®°å½•
â”œâ”€â”€ results/                   # å›æµ‹ç»“æœç›®å½•
â”‚   â””â”€â”€ trend_etf_pool_*.csv  # ETFç­›é€‰ç»“æœ
â””â”€â”€ data/                      # æ•°æ®ç›®å½•
    â””â”€â”€ csv/daily/etf/        # ETFæ—¥çº¿æ•°æ®
```

## æŠ€æœ¯ç»†èŠ‚

### ä¿¡å·æ£€æµ‹é€»è¾‘

```python
# æ£€æµ‹é‡‘å‰ï¼ˆä¹°å…¥ä¿¡å·ï¼‰
if sma_short_prev <= sma_long_prev and sma_short > sma_long:
    signal = 'BUY'

# æ£€æµ‹æ­»å‰ï¼ˆå–å‡ºä¿¡å·ï¼‰
elif sma_short_prev >= sma_long_prev and sma_short < sma_long:
    signal = 'SELL'

# æŒæœ‰å¤šå¤´
elif sma_short > sma_long:
    signal = 'HOLD_LONG'

# æŒæœ‰ç©ºå¤´
else:
    signal = 'HOLD_SHORT'
```

### æ•°æ®è¦æ±‚

- è‡³å°‘éœ€è¦30å¤©çš„å†å²æ•°æ®
- é»˜è®¤åŠ è½½æœ€è¿‘250ä¸ªäº¤æ˜“æ—¥æ•°æ®ï¼ˆçº¦1å¹´ï¼‰
- æ•°æ®æ ¼å¼ï¼šDate, Open, High, Low, Close, Volume

## æ”¯æŒä¸åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æŸ¥çœ‹ï¼š
- é¡¹ç›®æ–‡æ¡£ï¼š`README_BACKTESTING.md`
- å›æµ‹æ–‡æ¡£ï¼š`README_BACKTESTING.md`
- ETFç­›é€‰æ–‡æ¡£ï¼š`etf_selector/README.md`
