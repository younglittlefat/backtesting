# æ¯æ—¥äº¤æ˜“ä¿¡å·ç”Ÿæˆç³»ç»Ÿ

## åŠŸèƒ½æ¦‚è¿°

æ¯æ—¥äº¤æ˜“ä¿¡å·ç”Ÿæˆç³»ç»Ÿå¸®åŠ©æ‚¨åœ¨æ¯å¤©æ”¶ç›˜åï¼Œæ ¹æ®åŒå‡çº¿ç­–ç•¥ï¼ˆæˆ–å…¶ä»–ç­–ç•¥ï¼‰è‡ªåŠ¨åˆ†æè‚¡ç¥¨æ± ä¸­çš„æ‰€æœ‰æ ‡çš„ï¼Œç”Ÿæˆä¹°å…¥/å–å‡ºä¿¡å·å’Œèµ„é‡‘åˆ†é…å»ºè®®ã€‚

## æ ¸å¿ƒæ–‡ä»¶

- `generate_signals.py` - Pythonä¿¡å·ç”Ÿæˆè„šæœ¬
- `generate_daily_signals.sh` - Shellå¯åŠ¨è„šæœ¬ï¼ˆæ¨èä½¿ç”¨ï¼‰

## å¿«é€Ÿå¼€å§‹

### 1. æ¯å¤©æ”¶ç›˜åç”Ÿæˆäº¤æ˜“ä¿¡å·

```bash
# åŸºç¡€ç”¨æ³•
./generate_daily_signals.sh --stock-list results/trend_etf_pool_20251107.csv

# æŒ‡å®šå¯ç”¨èµ„é‡‘å’Œç›®æ ‡æŒä»“æ•°
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --cash 200000 \
  --positions 10

# ä¿å­˜æŠ¥å‘Šåˆ°æ–‡ä»¶
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --output signals/daily_$(date +%Y%m%d).txt \
  --csv signals/signals_$(date +%Y%m%d).csv
```

### 2. ä½¿ç”¨è‡ªå®šä¹‰ç­–ç•¥å‚æ•°

```bash
# ä½¿ç”¨çŸ­æœŸ5æ—¥å‡çº¿å’Œé•¿æœŸ20æ—¥å‡çº¿
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --n1 5 \
  --n2 20

# æ³¨æ„ï¼šç­–ç•¥å‚æ•°å¿…é¡»ä¸å›æµ‹æ—¶ä½¿ç”¨çš„å‚æ•°ä¸€è‡´ï¼
```

## å·¥ä½œæµç¨‹

### æ—¥å¸¸æ“ä½œæµç¨‹

1. **æ¯å¤©15:30å** - ç­‰å¾…å¸‚åœºæ”¶ç›˜ï¼Œè·å–æœ€æ–°æ•°æ®
2. **æ›´æ–°æ•°æ®** - ç¡®ä¿æ•°æ®å·²æ›´æ–°åˆ°å½“å¤©
3. **è¿è¡Œä¿¡å·ç”Ÿæˆ**:
   ```bash
   ./generate_daily_signals.sh \
     --stock-list results/trend_etf_pool_20251107.csv \
     --cash 100000 \
     --positions 10
   ```
4. **æŸ¥çœ‹æŠ¥å‘Š** - æ£€æŸ¥ä¹°å…¥/å–å‡ºä¿¡å·
5. **æ‰§è¡Œäº¤æ˜“** - æ ¹æ®å»ºè®®åœ¨è¯åˆ¸è´¦æˆ·ä¸­ä¸‹å•

### ä¿¡å·ç±»å‹è¯´æ˜

- **BUYï¼ˆä¹°å…¥ï¼‰** - é‡‘å‰ä¿¡å·ï¼ŒçŸ­æœŸå‡çº¿ä¸Šç©¿é•¿æœŸå‡çº¿
- **SELLï¼ˆå–å‡ºï¼‰** - æ­»å‰ä¿¡å·ï¼ŒçŸ­æœŸå‡çº¿ä¸‹ç©¿é•¿æœŸå‡çº¿
- **HOLD_LONGï¼ˆæŒæœ‰å¤šå¤´ï¼‰** - çŸ­æœŸå‡çº¿åœ¨é•¿æœŸå‡çº¿ä¸Šæ–¹ï¼Œç»§ç»­æŒæœ‰
- **HOLD_SHORTï¼ˆæŒæœ‰ç©ºå¤´ï¼‰** - çŸ­æœŸå‡çº¿åœ¨é•¿æœŸå‡çº¿ä¸‹æ–¹ï¼Œä¸å»ºè®®ä¹°å…¥

## è¾“å‡ºç¤ºä¾‹

```
================================================================================
äº¤æ˜“ä¿¡å·æŠ¥å‘Š - 2025-11-07 15:35:20
================================================================================

ğŸ“Š ä¿¡å·ç»Ÿè®¡
--------------------------------------------------------------------------------
  BUY: 3 åª
  HOLD_LONG: 15 åª
  HOLD_SHORT: 82 åª

ğŸ”” ä¹°å…¥ä¿¡å·ï¼ˆé‡‘å‰ï¼‰
--------------------------------------------------------------------------------
  588170.SH
    å½“å‰ä»·æ ¼: Â¥1.234
    çŸ­æœŸå‡çº¿: 1.235
    é•¿æœŸå‡çº¿: 1.220
    ä¿¡å·å¼ºåº¦: 1.23%
    è¯´æ˜: é‡‘å‰ä¹°å…¥ä¿¡å·ï¼çŸ­æœŸå‡çº¿(10æ—¥)ä¸Šç©¿é•¿æœŸå‡çº¿(20æ—¥)

  589010.SH
    å½“å‰ä»·æ ¼: Â¥2.567
    çŸ­æœŸå‡çº¿: 2.570
    é•¿æœŸå‡çº¿: 2.550
    ä¿¡å·å¼ºåº¦: 0.78%
    è¯´æ˜: é‡‘å‰ä¹°å…¥ä¿¡å·ï¼çŸ­æœŸå‡çº¿(10æ—¥)ä¸Šç©¿é•¿æœŸå‡çº¿(20æ—¥)

ğŸ’° èµ„é‡‘åˆ†é…å»ºè®®
--------------------------------------------------------------------------------
  æ€»èµ„é‡‘: Â¥100,000.00
  åˆ†é…èµ„é‡‘: Â¥98,500.00
  å‰©ä½™èµ„é‡‘: Â¥1,500.00
  å»ºè®®æŒä»“æ•°: 3

  å…·ä½“ä¹°å…¥å»ºè®®:

  [1] 588170.SH
      ä¹°å…¥ä»·æ ¼: Â¥1.23
      ä¹°å…¥æ•°é‡: 26500 è‚¡
      é¢„è®¡æˆæœ¬: Â¥32,595.00
      ä»“ä½å æ¯”: 32.60%
      ä¿¡å·å¼ºåº¦: 1.23%

  [2] 589010.SH
      ä¹°å…¥ä»·æ ¼: Â¥2.57
      ä¹°å…¥æ•°é‡: 12800 è‚¡
      é¢„è®¡æˆæœ¬: Â¥32,896.00
      ä»“ä½å æ¯”: 32.90%
      ä¿¡å·å¼ºåº¦: 0.78%

  [3] 159366.SZ
      ä¹°å…¥ä»·æ ¼: Â¥3.45
      ä¹°å…¥æ•°é‡: 9500 è‚¡
      é¢„è®¡æˆæœ¬: Â¥32,775.00
      ä»“ä½å æ¯”: 32.78%
      ä¿¡å·å¼ºåº¦: 0.56%
```

## å‚æ•°è¯´æ˜

### å¿…éœ€å‚æ•°

- `--stock-list` - è‚¡ç¥¨åˆ—è¡¨CSVæ–‡ä»¶ï¼ˆå¿…é¡»åŒ…å«ts_codeåˆ—ï¼‰

### å¯é€‰å‚æ•°

- `--strategy` - ç­–ç•¥åç§°ï¼ˆé»˜è®¤: sma_crossï¼‰
- `--cash` - å¯ç”¨èµ„é‡‘ï¼ˆé»˜è®¤: 100000ï¼‰
- `--positions` - ç›®æ ‡æŒä»“æ•°é‡ï¼ˆé»˜è®¤: 10ï¼‰
- `--cost-model` - è´¹ç”¨æ¨¡å‹ï¼ˆé»˜è®¤: cn_etfï¼‰
- `--data-dir` - æ•°æ®ç›®å½•ï¼ˆé»˜è®¤: data/csv/dailyï¼‰
- `--lookback-days` - å›çœ‹å¤©æ•°ï¼ˆé»˜è®¤: 250ï¼‰
- `--output` - æŠ¥å‘Šè¾“å‡ºæ–‡ä»¶è·¯å¾„
- `--csv` - CSVæ•°æ®è¾“å‡ºè·¯å¾„
- `--n1` - çŸ­æœŸå‡çº¿å‘¨æœŸ
- `--n2` - é•¿æœŸå‡çº¿å‘¨æœŸ

### è´¹ç”¨æ¨¡å‹

- `default` - æ— è´¹ç”¨ï¼ˆ0%ä½£é‡‘ï¼Œ0%æ»‘ç‚¹ï¼‰
- `cn_etf` - ä¸­å›½ETFï¼ˆ0.01%ä½£é‡‘ï¼Œ0.01%æ»‘ç‚¹ï¼‰â­ æ¨è
- `cn_stock` - ä¸­å›½Aè‚¡ï¼ˆ0.03%ä½£é‡‘ï¼Œ0.1%æ»‘ç‚¹ï¼Œå«å°èŠ±ç¨ï¼‰
- `us_stock` - ç¾è‚¡ï¼ˆ0.1%ä½£é‡‘ï¼Œ0.05%æ»‘ç‚¹ï¼‰

## èµ„é‡‘åˆ†é…è¯´æ˜

### åˆ†é…ç­–ç•¥

ç³»ç»Ÿä½¿ç”¨**ç­‰æƒé‡åˆ†é…**ç­–ç•¥ï¼š
1. ç­›é€‰å‡ºæ‰€æœ‰"BUY"ä¿¡å·çš„æ ‡çš„
2. æŒ‰ä¿¡å·å¼ºåº¦æ’åºï¼ˆå‡çº¿å·®å€¼ç™¾åˆ†æ¯”ï¼‰
3. å–å‰Nä¸ªæ ‡çš„ï¼ˆN = `--positions`å‚æ•°ï¼‰
4. å°†å¯ç”¨èµ„é‡‘å¹³å‡åˆ†é…ç»™è¿™Nä¸ªæ ‡çš„
5. è®¡ç®—æ¯ä¸ªæ ‡çš„çš„å…·ä½“ä¹°å…¥è‚¡æ•°ï¼ˆå‘ä¸‹å–æ•´åˆ°100è‚¡çš„å€æ•°ï¼‰

### ä¹°å…¥æ•°é‡è®¡ç®—

```python
# æ¯ä¸ªæ ‡çš„åˆ†é…èµ„é‡‘
cash_per_position = total_cash / n_positions

# è€ƒè™‘æ‰‹ç»­è´¹åçš„æœ‰æ•ˆèµ„é‡‘
effective_cash = cash_per_position * (1 - commission - spread)

# å¯ä¹°å…¥è‚¡æ•°ï¼ˆå‘ä¸‹å–æ•´åˆ°100è‚¡å€æ•°ï¼‰
shares = int(effective_cash / price / 100) * 100
```

### æ³¨æ„äº‹é¡¹

1. **Aè‚¡æœ€å°äº¤æ˜“å•ä½æ˜¯100è‚¡ï¼ˆ1æ‰‹ï¼‰**ï¼Œç³»ç»Ÿè‡ªåŠ¨å‘ä¸‹å–æ•´
2. **è€ƒè™‘äº†äº¤æ˜“æˆæœ¬**ï¼ˆä½£é‡‘+æ»‘ç‚¹ï¼‰ï¼Œå®é™…ä¹°å…¥é‡‘é¢ä¼šç•¥å°äºåˆ†é…èµ„é‡‘
3. **å»ºè®®é¢„ç•™ç°é‡‘**ï¼Œä¸è¦100%æ»¡ä»“ï¼Œç³»ç»Ÿé»˜è®¤ä¿å®ˆè®¡ç®—
4. **ä¿¡å·å¼ºåº¦ä½œä¸ºå‚è€ƒ**ï¼Œå¼ºåº¦è¶Šå¤§è¡¨ç¤ºå‡çº¿ä¹–ç¦»è¶Šå¤§

## ä¸å›æµ‹ç³»ç»Ÿçš„é…åˆä½¿ç”¨

### é‡è¦ï¼šç­–ç•¥å‚æ•°ä¸€è‡´æ€§

âš ï¸ **ç¡®ä¿ä¿¡å·ç”Ÿæˆæ—¶ä½¿ç”¨çš„ç­–ç•¥å‚æ•°ä¸å›æµ‹æ—¶ä¸€è‡´ï¼**

ä¾‹å¦‚ï¼Œå¦‚æœå›æµ‹æ—¶ä½¿ç”¨çš„æ˜¯ä¼˜åŒ–åçš„å‚æ•° `n1=15, n2=50`ï¼Œé‚£ä¹ˆç”Ÿæˆä¿¡å·æ—¶ä¹Ÿå¿…é¡»ä½¿ç”¨ç›¸åŒå‚æ•°ï¼š

```bash
# å›æµ‹æ—¶ä½¿ç”¨çš„å‚æ•°
./run_backtest.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --strategy sma_cross \
  --optimize \
  --data-dir data/csv/daily

# å‡è®¾ä¼˜åŒ–åæœ€ä½³å‚æ•°æ˜¯ n1=15, n2=50

# ä¿¡å·ç”Ÿæˆæ—¶ä¹Ÿè¦ä½¿ç”¨ç›¸åŒå‚æ•°
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --strategy sma_cross \
  --n1 15 \
  --n2 50 \
  --data-dir data/csv/daily
```

### å®Œæ•´å·¥ä½œæµ

```bash
# 1. å…ˆå¯¹è‚¡ç¥¨æ± è¿›è¡Œå›æµ‹å’Œä¼˜åŒ–
./run_backtest.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --strategy sma_cross \
  --optimize \
  --data-dir data/csv/daily

# 2. æŸ¥çœ‹results/etf/statsç›®å½•ä¸‹çš„CSVæ–‡ä»¶ï¼Œæ‰¾å‡ºæœ€ä½³å‚æ•°ç»„åˆ

# 3. æ¯å¤©æ”¶ç›˜åï¼Œä½¿ç”¨ç›¸åŒå‚æ•°ç”Ÿæˆä¿¡å·
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --strategy sma_cross \
  --n1 <ä¼˜åŒ–åçš„å€¼> \
  --n2 <ä¼˜åŒ–åçš„å€¼> \
  --cash 100000 \
  --positions 10 \
  --data-dir data/csv/daily
```

## é«˜çº§ç”¨æ³•

### å®šæ—¶ä»»åŠ¡

ä½¿ç”¨cronæ¯å¤©15:30è‡ªåŠ¨è¿è¡Œï¼š

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯ä¸ªäº¤æ˜“æ—¥15:30ï¼‰
30 15 * * 1-5 cd /path/to/backtesting && ./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --output signals/daily_$(date +\%Y\%m\%d).txt \
  --csv signals/signals_$(date +\%Y\%m\%d).csv
```

### Pythonè„šæœ¬ç›´æ¥è°ƒç”¨

å¦‚æœéœ€è¦æ›´å¤šè‡ªå®šä¹‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Pythonè„šæœ¬ï¼š

```bash
/home/zijunliu/miniforge3/condabin/conda run -n backtesting \
  python generate_signals.py \
  --stock-list results/trend_etf_pool_20251107.csv \
  --cash 100000 \
  --positions 10 \
  --n1 15 \
  --n2 50 \
  --data-dir data/csv/daily
```

### ç»“åˆå…¶ä»–å·¥å…·

```bash
# ç”Ÿæˆä¿¡å·å¹¶å‘é€é‚®ä»¶é€šçŸ¥
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --output /tmp/signals.txt && \
  mail -s "ä»Šæ—¥äº¤æ˜“ä¿¡å·" your@email.com < /tmp/signals.txt

# ç”Ÿæˆä¿¡å·å¹¶ä¿å­˜åˆ°å†å²è®°å½•
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --output signals/history/$(date +%Y%m%d).txt
```

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ²¡æœ‰ä¹°å…¥ä¿¡å·ï¼Ÿ

**A:** å¯èƒ½çš„åŸå› ï¼š
1. å½“å‰æ‰€æœ‰æ ‡çš„éƒ½å¤„äºä¸‹é™è¶‹åŠ¿ï¼ˆçŸ­æœŸå‡çº¿åœ¨é•¿æœŸå‡çº¿ä¸‹æ–¹ï¼‰
2. æœ€è¿‘æ²¡æœ‰é‡‘å‰ï¼ˆå‡çº¿äº¤å‰ï¼‰å‘ç”Ÿ
3. æ•°æ®æœªæ›´æ–°åˆ°æœ€æ–°äº¤æ˜“æ—¥

### Q2: å¦‚ä½•çŸ¥é“ä½¿ç”¨å“ªä¸ªç­–ç•¥å‚æ•°ï¼Ÿ

**A:** æ­¥éª¤ï¼š
1. å…ˆç”¨ `./run_backtest.sh --optimize` å¯¹è‚¡ç¥¨æ± è¿›è¡Œä¼˜åŒ–
2. æŸ¥çœ‹å›æµ‹ç»“æœï¼Œæ‰¾å‡ºæ”¶ç›Šç‡æœ€é«˜çš„å‚æ•°ç»„åˆ
3. åœ¨ä¿¡å·ç”Ÿæˆæ—¶ä½¿ç”¨ç›¸åŒçš„å‚æ•°

### Q3: ä¿¡å·å¼ºåº¦æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

**A:** ä¿¡å·å¼ºåº¦ = (çŸ­æœŸå‡çº¿ - é•¿æœŸå‡çº¿) / é•¿æœŸå‡çº¿ * 100%
- æ­£å€¼è¡¨ç¤ºçŸ­æœŸå‡çº¿åœ¨ä¸Šæ–¹ï¼ˆå¤šå¤´ï¼‰
- è´Ÿå€¼è¡¨ç¤ºçŸ­æœŸå‡çº¿åœ¨ä¸‹æ–¹ï¼ˆç©ºå¤´ï¼‰
- ç»å¯¹å€¼è¶Šå¤§ï¼Œä¹–ç¦»è¶Šå¤§

### Q4: ä¸ºä»€ä¹ˆä¹°å…¥æ•°é‡ä¸æ˜¯æ•´æ•°åƒæˆ–ä¸‡ï¼Ÿ

**A:** ç³»ç»Ÿæ ¹æ®ä»¥ä¸‹å› ç´ è®¡ç®—ï¼š
1. å¯ç”¨èµ„é‡‘ / æŒä»“æ•° = æ¯ä¸ªæ ‡çš„åˆ†é…èµ„é‡‘
2. å‡å»äº¤æ˜“æˆæœ¬ï¼ˆä½£é‡‘+æ»‘ç‚¹ï¼‰
3. é™¤ä»¥å½“å‰ä»·æ ¼ = å¯ä¹°è‚¡æ•°
4. å‘ä¸‹å–æ•´åˆ°100è‚¡çš„å€æ•°ï¼ˆAè‚¡æœ€å°äº¤æ˜“å•ä½ï¼‰

### Q5: å¯ä»¥ç”¨äºå®ç›˜è‡ªåŠ¨äº¤æ˜“å—ï¼Ÿ

**A:** æœ¬ç³»ç»Ÿ**ä»…ç”Ÿæˆå»ºè®®**ï¼Œä¸æ‰§è¡Œå®é™…äº¤æ˜“ã€‚æ‚¨éœ€è¦ï¼š
1. æŸ¥çœ‹æ¯æ—¥ä¿¡å·æŠ¥å‘Š
2. äººå·¥å®¡æ ¸å»ºè®®
3. åœ¨è¯åˆ¸è´¦æˆ·ä¸­æ‰‹åŠ¨ä¸‹å•

âš ï¸ **é£é™©æç¤º**:
- å†å²å›æµ‹è¡¨ç°ä¸ä»£è¡¨æœªæ¥æ”¶ç›Š
- å¸‚åœºæœ‰é£é™©ï¼ŒæŠ•èµ„éœ€è°¨æ…
- å»ºè®®ä»å°èµ„é‡‘å¼€å§‹æµ‹è¯•ç­–ç•¥æœ‰æ•ˆæ€§

## æ–‡ä»¶ç»“æ„

```
backtesting/
â”œâ”€â”€ generate_signals.py          # ä¿¡å·ç”ŸæˆPythonè„šæœ¬
â”œâ”€â”€ generate_daily_signals.sh    # Shellå¯åŠ¨è„šæœ¬
â”œâ”€â”€ README_SIGNALS.md           # æœ¬æ–‡æ¡£
â”œâ”€â”€ signals/                    # ä¿¡å·è¾“å‡ºç›®å½•ï¼ˆå»ºè®®åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ daily_20251107.txt     # æ¯æ—¥æŠ¥å‘Š
â”‚   â”œâ”€â”€ signals_20251107.csv   # æ¯æ—¥ä¿¡å·CSV
â”‚   â””â”€â”€ history/               # å†å²è®°å½•
â”œâ”€â”€ results/                   # å›æµ‹ç»“æœç›®å½•
â”‚   â””â”€â”€ trend_etf_pool_*.csv  # ETFç­›é€‰ç»“æœ
â””â”€â”€ data/                      # æ•°æ®ç›®å½•
    â””â”€â”€ csv/daily/etf/        # ETFæ—¥çº¿æ•°æ®
```

## æŠ€æœ¯ç»†èŠ‚

### ä¿¡å·æ£€æµ‹é€»è¾‘

```python
# æ£€æµ‹é‡‘å‰ï¼ˆä¹°å…¥ä¿¡å·ï¼‰
if sma_short_prev <= sma_long_prev and sma_short > sma_long:
    signal = 'BUY'

# æ£€æµ‹æ­»å‰ï¼ˆå–å‡ºä¿¡å·ï¼‰
elif sma_short_prev >= sma_long_prev and sma_short < sma_long:
    signal = 'SELL'

# æŒæœ‰å¤šå¤´
elif sma_short > sma_long:
    signal = 'HOLD_LONG'

# æŒæœ‰ç©ºå¤´
else:
    signal = 'HOLD_SHORT'
```

### æ•°æ®è¦æ±‚

- è‡³å°‘éœ€è¦30å¤©çš„å†å²æ•°æ®
- é»˜è®¤åŠ è½½æœ€è¿‘250ä¸ªäº¤æ˜“æ—¥æ•°æ®ï¼ˆçº¦1å¹´ï¼‰
- æ•°æ®æ ¼å¼ï¼šDate, Open, High, Low, Close, Volume

---

## ğŸš€ æŒç»­äº¤æ˜“ç³»ç»Ÿï¼ˆPortfolio Managementï¼‰

### é—®é¢˜åˆ†æ

**å½“å‰ç³»ç»Ÿçš„å±€é™æ€§ï¼š**

å½“å‰çš„ä¿¡å·ç”Ÿæˆç³»ç»Ÿæ˜¯**æ— çŠ¶æ€**çš„ï¼Œæ¯æ¬¡è¿è¡Œéƒ½å‡è®¾ä»é›¶å¼€å§‹å»ºä»“ã€‚è¿™åœ¨å®é™…äº¤æ˜“ä¸­å­˜åœ¨ä¸¥é‡é—®é¢˜ï¼š

1. **ç¬¬ä¸€å¤©**ï¼šå‡è®¾æœ‰10ä¸‡èµ„é‡‘ï¼Œç³»ç»Ÿå»ºè®®ä¹°å…¥Aã€Bã€Cä¸‰åªè‚¡ç¥¨ï¼Œæ¯åª3.3ä¸‡
2. **ç¬¬äºŒå¤©**ï¼šå‡è®¾Aå‡ºç°å–å‡ºä¿¡å·ï¼ŒDã€Eå‡ºç°ä¹°å…¥ä¿¡å·
   - âŒ **é”™è¯¯åšæ³•**ï¼šç³»ç»Ÿä»ç„¶å‡è®¾æœ‰10ä¸‡èµ„é‡‘ï¼Œå»ºè®®ä¹°å…¥Dã€Eã€Fä¸‰åªè‚¡ç¥¨
   - âœ… **æ­£ç¡®åšæ³•**ï¼šåº”è¯¥å–å‡ºAï¼ˆé‡Šæ”¾3.3ä¸‡ï¼‰ï¼Œç„¶åç”¨3.3ä¸‡ä¹°å…¥Dæˆ–E

**æ ¸å¿ƒé—®é¢˜ï¼š**
- ç³»ç»Ÿä¸çŸ¥é“æˆ‘å·²ç»æŒæœ‰å“ªäº›è‚¡ç¥¨
- ç³»ç»Ÿä¸çŸ¥é“æˆ‘è¿˜æœ‰å¤šå°‘å¯ç”¨ç°é‡‘
- ç³»ç»Ÿä¸èƒ½åšå‡ºå¢é‡å†³ç­–ï¼ˆåªå–ä¸åˆé€‚çš„ï¼Œåªä¹°æ–°çš„å¥½æ ‡çš„ï¼‰

### è§£å†³æ–¹æ¡ˆï¼šæŒä»“çŠ¶æ€ç®¡ç†ç³»ç»Ÿ

è®¾è®¡ä¸€ä¸ª**ç«¯åˆ°ç«¯çš„æŒç»­äº¤æ˜“ç³»ç»Ÿ**ï¼Œæ ¸å¿ƒæ˜¯å¼•å…¥**æŒä»“çŠ¶æ€æ–‡ä»¶**æ¥è®°å½•å½“å‰çœŸå®çŠ¶å†µã€‚

#### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ¯æ—¥äº¤æ˜“å¾ªç¯ï¼ˆDaily Loopï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  è¯»å–æŒä»“çŠ¶æ€æ–‡ä»¶           â”‚
        â”‚  portfolio.json           â”‚
        â”‚  â€¢ å½“å‰æŒä»“åˆ—è¡¨            â”‚
        â”‚  â€¢ å¯ç”¨ç°é‡‘               â”‚
        â”‚  â€¢ æŒä»“æˆæœ¬ã€æ•°é‡          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ç”Ÿæˆæœ€æ–°ä¿¡å·              â”‚
        â”‚  (analyze mode)           â”‚
        â”‚  â€¢ åˆ†æè‚¡ç¥¨æ± æ‰€æœ‰æ ‡çš„       â”‚
        â”‚  â€¢ è·å–BUY/SELLä¿¡å·        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  å¢é‡å†³ç­–é€»è¾‘              â”‚
        â”‚  â€¢ å·²æŒæœ‰ + SELL â†’ å–å‡º   â”‚
        â”‚  â€¢ æœªæŒæœ‰ + BUY â†’ ä¹°å…¥    â”‚
        â”‚  â€¢ å·²æŒæœ‰ + HOLD â†’ ç»§ç»­   â”‚
        â”‚  â€¢ è€ƒè™‘æŒä»“ä¸Šé™            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ˜¾ç¤ºäº¤æ˜“å»ºè®®              â”‚
        â”‚  â€¢ å–å‡ºæ¸…å•               â”‚
        â”‚  â€¢ ä¹°å…¥æ¸…å•               â”‚
        â”‚  â€¢ èµ„é‡‘åˆ†é…               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
              ç”¨æˆ·ç¡®è®¤ï¼ŸYes/No
                        â”‚
                        â–¼ Yes
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ‰§è¡Œäº¤æ˜“                 â”‚
        â”‚  (execute mode)           â”‚
        â”‚  â€¢ æ›´æ–°ç°é‡‘ä½™é¢            â”‚
        â”‚  â€¢ æ›´æ–°æŒä»“åˆ—è¡¨            â”‚
        â”‚  â€¢ è®°å½•äº¤æ˜“å†å²            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ä¿å­˜æŒä»“çŠ¶æ€æ–‡ä»¶           â”‚
        â”‚  portfolio.json           â”‚
        â”‚  â€¢ æ–°çš„æŒä»“åˆ—è¡¨            â”‚
        â”‚  â€¢ æ–°çš„ç°é‡‘ä½™é¢            â”‚
        â”‚  â€¢ æ—¶é—´æˆ³                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŒä»“çŠ¶æ€æ–‡ä»¶æ ¼å¼

**`positions/portfolio.json`** - æ ¸å¿ƒçŠ¶æ€æ–‡ä»¶

```json
{
  "cash": 35000.00,
  "positions": [
    {
      "ts_code": "159001.SZ",
      "shares": 10000,
      "entry_price": 3.25,
      "entry_date": "2025-11-06",
      "cost": 32512.50
    },
    {
      "ts_code": "510300.SH",
      "shares": 5000,
      "entry_price": 4.15,
      "entry_date": "2025-11-07",
      "cost": 20770.00
    }
  ],
  "last_update": "2025-11-07 15:35:20"
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `cash`: å½“å‰å¯ç”¨ç°é‡‘
- `positions`: æŒä»“åˆ—è¡¨
  - `ts_code`: è‚¡ç¥¨ä»£ç 
  - `shares`: æŒæœ‰è‚¡æ•°
  - `entry_price`: ä¹°å…¥å‡ä»·
  - `entry_date`: å»ºä»“æ—¥æœŸ
  - `cost`: æŒä»“æˆæœ¬ï¼ˆå«æ‰‹ç»­è´¹ï¼‰
- `last_update`: æœ€åæ›´æ–°æ—¶é—´

#### å¢é‡å†³ç­–é€»è¾‘

**å–å‡ºé€»è¾‘ï¼ˆä¼˜å…ˆå¤„ç†ï¼‰ï¼š**
```python
for each æ ‡çš„ in å½“å‰æŒä»“:
    signal = get_signal(æ ‡çš„)
    if signal == 'SELL':  # æ­»å‰
        â†’ ç”Ÿæˆå–å‡ºæ“ä½œ
        â†’ é‡Šæ”¾èµ„é‡‘ = shares Ã— price Ã— (1 - æ‰‹ç»­è´¹)
```

**ä¹°å…¥é€»è¾‘ï¼ˆè€ƒè™‘æŒä»“ä¸Šé™ï¼‰ï¼š**
```python
# è®¡ç®—å¯ç”¨æŒä»“æ§½ä½
available_slots = max_positions - (len(å½“å‰æŒä»“) - len(å–å‡ºæ“ä½œ))

# ç­›é€‰ä¹°å…¥å€™é€‰
buy_candidates = [æ ‡çš„ for æ ‡çš„ in è‚¡ç¥¨æ± 
                  if signal == 'BUY'
                  and æ ‡çš„ not in å½“å‰æŒä»“]

# æŒ‰ä¿¡å·å¼ºåº¦æ’åºï¼Œå–å‰Nä¸ª
buy_candidates = sorted(buy_candidates, by='signal_strength')[:available_slots]

# è®¡ç®—å¯ç”¨èµ„é‡‘
available_cash = å½“å‰ç°é‡‘ + sum(å–å‡ºæ“ä½œçš„æ”¶å…¥)

# ç­‰æƒåˆ†é…
for æ ‡çš„ in buy_candidates:
    åˆ†é…èµ„é‡‘ = available_cash / len(buy_candidates)
    è‚¡æ•° = int((åˆ†é…èµ„é‡‘ / price) / 100) * 100
    â†’ ç”Ÿæˆä¹°å…¥æ“ä½œ
```

**ç»§ç»­æŒæœ‰é€»è¾‘ï¼š**
```python
for each æ ‡çš„ in å½“å‰æŒä»“:
    signal = get_signal(æ ‡çš„)
    if signal == 'HOLD_LONG':
        â†’ ä¸æ“ä½œï¼Œç»§ç»­æŒæœ‰
```

#### å·¥ä½œæµç¨‹

**1. åˆå§‹åŒ–ï¼ˆç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼‰**

```bash
# åˆ›å»ºåˆå§‹æŒä»“çŠ¶æ€æ–‡ä»¶
./generate_daily_signals.sh \
  --init 100000 \
  --portfolio-file positions/portfolio.json
```

è¾“å‡ºï¼š
```
âœ“ æŒä»“çŠ¶æ€å·²åˆå§‹åŒ–
  åˆå§‹èµ„é‡‘: Â¥100,000.00
  æŒä»“æ–‡ä»¶: positions/portfolio.json
```

**2. æ¯æ—¥åˆ†æï¼ˆæŸ¥çœ‹æ¨¡å¼ï¼‰**

```bash
# åˆ†æå½“å‰ä¿¡å·ï¼Œä½†ä¸æ‰§è¡Œäº¤æ˜“
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --portfolio-file positions/portfolio.json \
  --analyze
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
================================================================================
å½“å‰æŒä»“çŠ¶æ€
================================================================================

ğŸ’° èµ„é‡‘ä¿¡æ¯
--------------------------------------------------------------------------------
  å¯ç”¨ç°é‡‘: Â¥35,000.00
  æŒä»“å¸‚å€¼: Â¥65,000.00
  æ€»èµ„äº§:   Â¥100,000.00
  æŒä»“ç›ˆäº: +Â¥2,500.00 (+4.00%)

ğŸ“Š æŒä»“æ˜ç»† (2/10)
--------------------------------------------------------------------------------
  159001.SZ
    æŒä»“æ•°é‡: 10000 è‚¡
    ä¹°å…¥ä»·æ ¼: Â¥3.25 (2025-11-06)
    å½“å‰ä»·æ ¼: Â¥3.35
    æŒä»“æˆæœ¬: Â¥32,512.50
    å½“å‰å¸‚å€¼: Â¥33,500.00
    ç›ˆäº:     +Â¥987.50 (+3.04%)

  510300.SH
    æŒä»“æ•°é‡: 5000 è‚¡
    ä¹°å…¥ä»·æ ¼: Â¥4.15 (2025-11-07)
    å½“å‰ä»·æ ¼: Â¥4.30
    æŒä»“æˆæœ¬: Â¥20,770.00
    å½“å‰å¸‚å€¼: Â¥21,500.00
    ç›ˆäº:     +Â¥730.00 (+3.51%)

================================================================================
äº¤æ˜“å»ºè®®
================================================================================

ğŸ“‰ å–å‡ºæ“ä½œ (1)
--------------------------------------------------------------------------------
  [1] 159001.SZ
      æ“ä½œ: å–å‡º
      ä»·æ ¼: Â¥3.35
      æ•°é‡: 10000 è‚¡
      é¢„è®¡æ”¶å…¥: Â¥33,466.50
      åŸå› : æ­»å‰å–å‡ºä¿¡å·ï¼çŸ­æœŸå‡çº¿(10æ—¥)ä¸‹ç©¿é•¿æœŸå‡çº¿(20æ—¥)

ğŸ“ˆ ä¹°å…¥æ“ä½œ (1)
--------------------------------------------------------------------------------
  [1] 588170.SH
      æ“ä½œ: ä¹°å…¥
      ä»·æ ¼: Â¥1.23
      æ•°é‡: 55600 è‚¡
      é¢„è®¡æˆæœ¬: Â¥68,388.00
      ä¿¡å·å¼ºåº¦: 1.23%
      åŸå› : é‡‘å‰ä¹°å…¥ä¿¡å·ï¼çŸ­æœŸå‡çº¿(10æ—¥)ä¸Šç©¿é•¿æœŸå‡çº¿(20æ—¥)

================================================================================
```

**3. æ‰§è¡Œäº¤æ˜“ï¼ˆæ‰§è¡Œæ¨¡å¼ï¼‰**

```bash
# ç¡®è®¤æ— è¯¯åï¼Œæ‰§è¡Œäº¤æ˜“å¹¶æ›´æ–°æŒä»“
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool_20251107.csv \
  --portfolio-file positions/portfolio.json \
  --execute
```

äº¤äº’å¼ç¡®è®¤ï¼š
```
âš ï¸  å³å°†æ‰§è¡Œäº¤æ˜“æ“ä½œï¼Œè¯·ç¡®è®¤ï¼š
  - å–å‡º 1 åªæ ‡çš„
  - ä¹°å…¥ 1 åªæ ‡çš„

æ˜¯å¦ç¡®è®¤æ‰§è¡Œï¼Ÿ(yes/no): yes

å¼€å§‹æ‰§è¡Œäº¤æ˜“...
âœ“ å–å‡º: 159001.SZ 10000è‚¡ @Â¥3.35 æ”¶å…¥Â¥33,466.50
âœ“ ä¹°å…¥: 588170.SH 55600è‚¡ @Â¥1.23 æˆæœ¬Â¥68,388.00

âœ“ æŒä»“å·²æ›´æ–°: positions/portfolio.json
âœ“ äº¤æ˜“è®°å½•å·²ä¿å­˜: positions/history/trades_20251107.json
```

**4. æŸ¥çœ‹æŒä»“ï¼ˆçŠ¶æ€æ¨¡å¼ï¼‰**

```bash
# éšæ—¶æŸ¥çœ‹å½“å‰æŒä»“çŠ¶æ€
./generate_daily_signals.sh \
  --portfolio-file positions/portfolio.json \
  --status
```

#### å®Œæ•´å‘½ä»¤å‚æ•°

```bash
./generate_daily_signals.sh \
  --stock-list <è‚¡ç¥¨æ± CSV> \              # å¿…éœ€
  --portfolio-file <æŒä»“JSON> \           # æŒä»“çŠ¶æ€æ–‡ä»¶è·¯å¾„
  --strategy <ç­–ç•¥å> \                    # é»˜è®¤sma_cross
  --n1 <çŸ­æœŸ> --n2 <é•¿æœŸ> \                # ç­–ç•¥å‚æ•°
  --max-positions <æ•°é‡> \                 # æœ€å¤§æŒä»“æ•°ï¼ˆé»˜è®¤10ï¼‰
  --cost-model <æ¨¡å‹> \                    # è´¹ç”¨æ¨¡å‹ï¼ˆé»˜è®¤cn_etfï¼‰
  [--init <åˆå§‹èµ„é‡‘>] \                    # åˆå§‹åŒ–æ¨¡å¼
  [--analyze] \                           # åˆ†ææ¨¡å¼ï¼ˆä¸æ‰§è¡Œï¼‰
  [--execute] \                           # æ‰§è¡Œæ¨¡å¼ï¼ˆæ›´æ–°æŒä»“ï¼‰
  [--status]                              # æŸ¥çœ‹æŒä»“çŠ¶æ€
```

#### å…¸å‹ä½¿ç”¨åœºæ™¯

**åœºæ™¯1ï¼šå®Œå…¨æ–°æ‰‹ç¬¬ä¸€æ¬¡ä½¿ç”¨**

```bash
# Day 0: åˆå§‹åŒ–æŒä»“ï¼ŒæŠ•å…¥10ä¸‡
./generate_daily_signals.sh --init 100000 --portfolio-file positions/portfolio.json

# Day 1: ç¬¬ä¸€å¤©æ”¶ç›˜ååˆ†æ
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool.csv \
  --portfolio-file positions/portfolio.json \
  --analyze

# ç¡®è®¤åæ‰§è¡Œ
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool.csv \
  --portfolio-file positions/portfolio.json \
  --execute
```

**åœºæ™¯2ï¼šå·²æœ‰æŒä»“ï¼Œå¯¼å…¥ç°æœ‰ä»“ä½**

```bash
# æ‰‹åŠ¨ç¼–è¾‘ positions/portfolio.jsonï¼Œå½•å…¥å½“å‰çœŸå®æŒä»“
vim positions/portfolio.json

# ç„¶åæ­£å¸¸ä½¿ç”¨
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool.csv \
  --portfolio-file positions/portfolio.json \
  --analyze
```

**åœºæ™¯3ï¼šæ¯æ—¥æ“ä½œæµç¨‹ï¼ˆæœ€å¸¸ç”¨ï¼‰**

```bash
# æ¯å¤©15:30åï¼Œä¸€é”®åˆ†æ+æ‰§è¡Œ
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool.csv \
  --portfolio-file positions/portfolio.json \
  --analyze && \
./generate_daily_signals.sh \
  --stock-list results/trend_etf_pool.csv \
  --portfolio-file positions/portfolio.json \
  --execute
```

**åœºæ™¯4ï¼šå®šæ—¶ä»»åŠ¡è‡ªåŠ¨åŒ–**

```bash
# crontabå®šæ—¶ä»»åŠ¡ï¼ˆä»…åˆ†ææ¨¡å¼ï¼Œå‘é€é€šçŸ¥ï¼‰
30 15 * * 1-5 cd /path/to/backtesting && \
  ./generate_daily_signals.sh \
    --stock-list results/trend_etf_pool.csv \
    --portfolio-file positions/portfolio.json \
    --analyze \
    --output /tmp/signals.txt && \
  mail -s "ä»Šæ—¥äº¤æ˜“ä¿¡å·" your@email.com < /tmp/signals.txt
```

#### æ–‡ä»¶ç»“æ„

```
backtesting/
â”œâ”€â”€ generate_signals.py              # ä¿¡å·ç”Ÿæˆè„šæœ¬ï¼ˆå¢å¼ºç‰ˆï¼‰
â”œâ”€â”€ generate_daily_signals.sh        # ç»Ÿä¸€å…¥å£è„šæœ¬ï¼ˆç«¯åˆ°ç«¯ï¼‰
â”œâ”€â”€ README_SIGNALS.md               # æœ¬æ–‡æ¡£
â”œâ”€â”€ positions/                       # æŒä»“ç®¡ç†ç›®å½• â­ NEW
â”‚   â”œâ”€â”€ portfolio.json              # å½“å‰æŒä»“çŠ¶æ€æ–‡ä»¶
â”‚   â””â”€â”€ history/                    # äº¤æ˜“å†å²è®°å½•
â”‚       â”œâ”€â”€ trades_20251106.json    # æ¯æ—¥äº¤æ˜“è®°å½•
â”‚       â”œâ”€â”€ trades_20251107.json
â”‚       â””â”€â”€ portfolio_backup/       # æŒä»“å¤‡ä»½ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ signals/                        # ä¿¡å·è¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ daily_20251107.txt
â”‚   â””â”€â”€ signals_20251107.csv
â””â”€â”€ data/                           # æ•°æ®ç›®å½•
    â””â”€â”€ csv/daily/
```

#### æŠ€æœ¯å®ç°è¦ç‚¹

**1. æŒä»“çŠ¶æ€æŒä¹…åŒ–**
- ä½¿ç”¨JSONæ ¼å¼å­˜å‚¨ï¼Œä¾¿äºäººå·¥æŸ¥çœ‹å’Œä¿®æ”¹
- æ¯æ¬¡äº¤æ˜“åè‡ªåŠ¨æ›´æ–°
- ä¿ç•™å†å²å¤‡ä»½ï¼ˆå¯é€‰ï¼‰

**2. å¢é‡å†³ç­–å¼•æ“**
- ä¼˜å…ˆå¤„ç†å–å‡ºï¼ˆé‡Šæ”¾èµ„é‡‘ï¼‰
- å†è®¡ç®—ä¹°å…¥ï¼ˆä½¿ç”¨é‡Šæ”¾çš„èµ„é‡‘ï¼‰
- è€ƒè™‘æŒä»“ä¸Šé™å’Œèµ„é‡‘çº¦æŸ

**3. äº¤æ˜“å†å²è®°å½•**
- æ¯æ—¥äº¤æ˜“æ“ä½œè®°å½•åˆ° `history/trades_YYYYMMDD.json`
- åŒ…å«ä¹°å–ä»·æ ¼ã€æ•°é‡ã€åŸå› 
- ä¾¿äºäº‹åå¤ç›˜å’Œå®¡è®¡

**4. å®‰å…¨æœºåˆ¶**
- æ‰§è¡Œæ¨¡å¼éœ€è¦ç”¨æˆ·ç¡®è®¤ï¼ˆäº¤äº’å¼yes/noï¼‰
- åˆ†ææ¨¡å¼ä¸ä¿®æ”¹ä»»ä½•æ–‡ä»¶
- çŠ¶æ€æ¨¡å¼åªè¯»å–ä¸ä¿®æ”¹

**5. é”™è¯¯å¤„ç†**
- æŒä»“æ–‡ä»¶ä¸å­˜åœ¨æ—¶æç¤ºåˆå§‹åŒ–
- ç°é‡‘ä¸è¶³æ—¶æ‹’ç»ä¹°å…¥
- å–å‡ºä¸å­˜åœ¨çš„æŒä»“æ—¶è­¦å‘Š

#### ä¸ç°æœ‰ç³»ç»Ÿçš„å…¼å®¹æ€§

âœ… **å®Œå…¨å‘åå…¼å®¹ï¼š**
- ä¸ä½¿ç”¨ `--portfolio-file` å‚æ•°æ—¶ï¼Œè¡Œä¸ºä¸åŸç³»ç»Ÿå®Œå…¨ä¸€è‡´
- åŸæœ‰çš„æ— çŠ¶æ€æ¨¡å¼ä¾ç„¶å¯ç”¨
- æ‰€æœ‰åŸæœ‰å‚æ•°å’ŒåŠŸèƒ½ä¿æŒä¸å˜

âœ… **æ¸è¿›å¼å‡çº§ï¼š**
- å¯ä»¥å…ˆç”¨æ— çŠ¶æ€æ¨¡å¼è¯•æ°´
- ç†Ÿæ‚‰åå†å¯ç”¨æŒä»“ç®¡ç†
- ä¸éœ€è¦ä¸€æ¬¡æ€§æ”¹å˜æ‰€æœ‰æµç¨‹

#### ä¼˜åŠ¿æ€»ç»“

1. **çœŸå®äº¤æ˜“åœºæ™¯**ï¼šå®Œå…¨æ¨¡æ‹ŸçœŸå®çš„æŒç»­äº¤æ˜“è¿‡ç¨‹
2. **çŠ¶æ€å¯è¿½æº¯**ï¼šæ¯ä¸€æ­¥æ“ä½œéƒ½æœ‰è®°å½•ï¼Œä¾¿äºå¤ç›˜
3. **å¢é‡å†³ç­–**ï¼šåªäº¤æ˜“éœ€è¦è°ƒæ•´çš„éƒ¨åˆ†ï¼Œå‡å°‘ä¸å¿…è¦çš„äº¤æ˜“æˆæœ¬
4. **èµ„é‡‘æ•ˆç‡**ï¼šå……åˆ†åˆ©ç”¨å–å‡ºé‡Šæ”¾çš„èµ„é‡‘
5. **é£é™©å¯æ§**ï¼šæŒä»“ä¸Šé™ã€äº¤æ˜“ç¡®è®¤ç­‰ä¿æŠ¤æœºåˆ¶
6. **ç«¯åˆ°ç«¯é›†æˆ**ï¼šä¸€ä¸ªè„šæœ¬æå®šæ‰€æœ‰æ“ä½œï¼Œæ— éœ€åœ¨å¤šä¸ªå·¥å…·é—´åˆ‡æ¢

#### æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦æé†’ï¼š**

1. **æŒä»“æ–‡ä»¶æ˜¯å”¯ä¸€çœŸå®çŠ¶æ€æ¥æº**
   - å¿…é¡»ä¸å®é™…è¯åˆ¸è´¦æˆ·ä¿æŒåŒæ­¥
   - æ¯æ¬¡çœŸå®äº¤æ˜“åï¼Œæ‰‹åŠ¨æ ¸å¯¹å¹¶æ›´æ–°ï¼ˆå¦‚æœå®é™…æˆäº¤ä»·æ ¼æˆ–æ•°é‡ä¸åŒï¼‰

2. **ç³»ç»Ÿå‡è®¾å®Œå…¨æˆäº¤**
   - é»˜è®¤æŒ‰å»ºè®®ä»·æ ¼å’Œæ•°é‡100%æˆäº¤
   - å®é™…å¯èƒ½å‡ºç°éƒ¨åˆ†æˆäº¤æˆ–ä»·æ ¼åå·®
   - éœ€è¦æ‰‹åŠ¨ä¿®æ­£æŒä»“æ–‡ä»¶

3. **ä¸æ”¯æŒå¤æ‚åœºæ™¯**
   - ä¸æ”¯æŒT+0æ—¥å†…äº¤æ˜“
   - ä¸æ”¯æŒå¤šè´¦æˆ·ç®¡ç†
   - ä¸æ”¯æŒèèµ„èåˆ¸

4. **å®šæœŸå¤‡ä»½**
   - å»ºè®®æ¯å‘¨å¤‡ä»½ `positions/` ç›®å½•
   - å¯ä½¿ç”¨ git ç‰ˆæœ¬æ§åˆ¶

---

## ğŸ¯ ç³»ç»ŸéªŒæ”¶çŠ¶æ€

**éªŒæ”¶æ—¥æœŸ**: 2025-11-08
**æµ‹è¯•ç¯å¢ƒ**: WSL2 Ubuntu 24, Condaç¯å¢ƒ: backtesting
**éªŒæ”¶çŠ¶æ€**: âš ï¸ **éƒ¨åˆ†åŠŸèƒ½ç”Ÿäº§å°±ç»ª**

### å·²éªŒè¯åŠŸèƒ½

- âœ… **åˆå§‹åŒ–æ¨¡å¼** (`--init`): åˆ›å»ºåˆå§‹æŒä»“æ–‡ä»¶
- âœ… **çŠ¶æ€æŸ¥çœ‹** (`--status`): å®æ—¶æŸ¥çœ‹æŒä»“å’Œç›ˆäº
- âœ… **åˆ†ææ¨¡å¼** (`--analyze`): ç”Ÿæˆäº¤æ˜“å»ºè®®ï¼ˆå¯ç”¨äºå®ç›˜ï¼‰
- âš ï¸ **æ‰§è¡Œæ¨¡å¼** (`--execute`): **æš‚ä¸å»ºè®®ç”¨äºå®ç›˜**ï¼ˆä»·æ ¼æ˜ å°„é—®é¢˜ï¼‰
- âœ… **ç›ˆäºè®¡ç®—**: è‡ªåŠ¨è®¡ç®—æŒä»“å¸‚å€¼å’Œç›ˆäºç™¾åˆ†æ¯”
- âœ… **å¢é‡å†³ç­–**: åŸºäºå½“å‰æŒä»“æ™ºèƒ½ç”Ÿæˆäº¤æ˜“è®¡åˆ’
- âœ… **å‘åå…¼å®¹**: æ— çŠ¶æ€æ¨¡å¼å®Œå…¨ä¿ç•™
- âœ… **è´¹ç”¨ä¸€è‡´æ€§**: ä¸backtestingæ¡†æ¶å®Œå…¨ä¸€è‡´

### æµ‹è¯•ç»“æœæ‘˜è¦

```bash
# æµ‹è¯•1: åˆå§‹åŒ– âœ…
./generate_daily_signals.sh --init 100000 --portfolio-file positions/portfolio.json
# ç»“æœ: æˆåŠŸåˆ›å»ºæŒä»“æ–‡ä»¶ï¼Œåˆå§‹èµ„é‡‘10ä¸‡

# æµ‹è¯•2: çŠ¶æ€æŸ¥çœ‹ âœ…
./generate_daily_signals.sh --status --portfolio-file positions/portfolio.json
# ç»“æœ: æ­£ç¡®æ˜¾ç¤ºæŒä»“æ˜ç»†ã€å¸‚å€¼ã€ç›ˆäº

# æµ‹è¯•3: åˆ†ææ¨¡å¼ âœ…
./generate_daily_signals.sh --analyze \
  --stock-list results/trend_etf_pool_20251107.csv \
  --portfolio-file positions/portfolio.json
# ç»“æœ: æ­£ç¡®ç”Ÿæˆå¢é‡äº¤æ˜“å»ºè®®ï¼ˆä½†ä»·æ ¼ä¸ºå¤æƒä»·æ ¼ï¼‰

# æµ‹è¯•4: å‘åå…¼å®¹ âœ…
./generate_daily_signals.sh --stock-list results/trend_etf_pool.csv --cash 100000
# ç»“æœ: åŸæœ‰æ— çŠ¶æ€æ¨¡å¼æ­£å¸¸å·¥ä½œ
```

### å½“å‰æ¨èä½¿ç”¨æ–¹å¼

**æ–¹å¼1: åˆ†ææ¨¡å¼ + æ‰‹åŠ¨ä¸‹å•ï¼ˆæ¨èï¼‰**
```bash
# æ¯å¤©æ”¶ç›˜åè¿è¡Œåˆ†æ
./generate_daily_signals.sh --analyze \
  --stock-list results/trend_etf_pool.csv \
  --portfolio-file positions/portfolio.json

# æŸ¥çœ‹å»ºè®®çš„ä¹°å…¥/å–å‡ºæ ‡çš„
# æ‰‹åŠ¨è®¡ç®—å®ç›˜ä»·æ ¼ï¼ˆå¤æƒä»·æ ¼ / å¤æƒå› å­ï¼‰
# åœ¨åˆ¸å•†è½¯ä»¶ä¸­æŒ‰å®ç›˜ä»·æ ¼ä¸‹å•
```

**æ–¹å¼2: æ— çŠ¶æ€æ¨¡å¼ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰**
```bash
# ä¸ä½¿ç”¨æŒä»“ç®¡ç†ï¼Œæ¯æ¬¡ä»é›¶å¼€å§‹
./generate_daily_signals.sh --stock-list results/trend_etf_pool.csv --cash 100000
```

### ä½¿ç”¨å»ºè®®

1. **ä»å°èµ„é‡‘å¼€å§‹**: å»ºè®®åˆå§‹æŠ•å…¥1-2ä¸‡è¿›è¡Œæµ‹è¯•
2. **ä»…ç”¨åˆ†ææ¨¡å¼**: ä½¿ç”¨ `--analyze` æŸ¥çœ‹å»ºè®®ï¼Œæš‚ä¸ä½¿ç”¨ `--execute`
3. **æ‰‹åŠ¨è½¬æ¢ä»·æ ¼**: å°†å¤æƒä»·æ ¼é™¤ä»¥å¤æƒå› å­å¾—åˆ°å®ç›˜ä»·æ ¼
4. **å®šæœŸå¤‡ä»½**: å»ºè®®ç”¨gitç®¡ç† `positions/` ç›®å½•
5. **æ ¸å¯¹æŒä»“**: æ¯æ¬¡äº¤æ˜“åæ ¸å¯¹æŒä»“æ–‡ä»¶ä¸å®é™…è´¦æˆ·

### å·²çŸ¥é™åˆ¶

- âš ï¸ **æ‰§è¡Œæ¨¡å¼ä½¿ç”¨å¤æƒä»·æ ¼**ï¼šéœ€è¦æ‰‹åŠ¨æ˜ å°„å›åŸå§‹ä»·æ ¼æ‰èƒ½å®ç›˜äº¤æ˜“
- ä¿¡å·æ£€æµ‹ä»…è¯†åˆ«**é‡‘å‰/æ­»å‰æ—¶åˆ»**ï¼ŒæŒç»­çš„å¤šå¤´/ç©ºå¤´ä¸è§¦å‘äº¤æ˜“
- å‡è®¾è®¢å•100%æˆäº¤ï¼Œå®é™…éœ€æ‰‹åŠ¨æ ¸å¯¹
- ä¸æ”¯æŒT+0ã€èèµ„èåˆ¸ç­‰å¤æ‚åœºæ™¯

### å…³é”®æŠ€æœ¯é—®ç­”

#### Q1: æŒä»“ç®¡ç†ç³»ç»Ÿä¸backtestingæ¡†æ¶çš„ä¸€è‡´æ€§å¦‚ä½•ï¼Ÿ

**A: âœ… å®Œå…¨ä¸€è‡´**

æŒä»“ç®¡ç†ç³»ç»Ÿçš„è´¹ç”¨è®¡ç®—å’Œèµ„é‡‘ç®¡ç†é€»è¾‘ä¸backtestingæ¡†æ¶ä¿æŒä¸¥æ ¼ä¸€è‡´ï¼š

1. **è´¹ç”¨è®¡ç®—ä¸€è‡´æ€§**:
   - ä¸¤è€…ä½¿ç”¨ç›¸åŒçš„ `commission` å’Œ `spread` å‚æ•°
   - å–å‡ºæ”¶å…¥ = `shares Ã— price Ã— (1 - commission)`
   - ä¹°å…¥æˆæœ¬ = `shares Ã— price Ã— (1 + commission + spread)`

2. **èµ„é‡‘åˆ†é…é€»è¾‘**:
   - æŒä»“ç®¡ç†: `effective_cash = cash_per_position Ã— (1 - commission - spread)`
   - æ— çŠ¶æ€æ¨¡å¼: `effective_cash = cash_per_position Ã— (1 - commission - spread)`
   - **å®Œå…¨ç›¸åŒ**

3. **ä»£ç ä½ç½®å¯¹æ¯”**:
   ```python
   # portfolio_manager.py:446 (æŒä»“ç®¡ç†)
   effective_cash = cash_per_position * (1 - self.commission - self.spread)

   # generate_signals.py:293 (æ— çŠ¶æ€æ¨¡å¼)
   effective_cash = cash_per_position * (1 - self.commission - self.spread)
   ```

**ç»“è®º**: æŒä»“ç®¡ç†ç³»ç»Ÿå’Œbacktestingæ¡†æ¶ä½¿ç”¨ç›¸åŒçš„è´¹ç”¨æ¨¡å‹å’Œèµ„é‡‘åˆ†é…é€»è¾‘ï¼Œç¡®ä¿å›æµ‹ç»“æœä¸å®ç›˜è¡¨ç°ä¸€è‡´ã€‚

---

#### Q2: æ¯æ—¥è°ƒä»“ä½¿ç”¨çš„ä»·æ ¼æ˜¯å¤æƒå‰è¿˜æ˜¯å¤æƒåï¼Ÿ

**A: âœ… å·²ä¿®å¤ - ç°åœ¨ä½¿ç”¨åŒä»·æ ¼æ¨¡å¼ï¼ˆ2025-11-08ï¼‰**

1. **ä¿®å¤æ–¹æ¡ˆ**:
   - **ä¿¡å·è®¡ç®—**: ä½¿ç”¨å¤æƒä»·æ ¼ï¼ˆç¡®ä¿æŠ€æœ¯æŒ‡æ ‡å‡†ç¡®ï¼‰
   - **äº¤æ˜“æ‰§è¡Œ**: ä½¿ç”¨åŸå§‹ä»·æ ¼ï¼ˆç¬¦åˆå®ç›˜äº¤æ˜“ï¼‰
   - **è‡ªåŠ¨æ˜ å°„**: ç³»ç»Ÿè‡ªåŠ¨å¤„ç†ä¸¤ç§ä»·æ ¼ä¹‹é—´çš„æ˜ å°„

2. **æŠ€æœ¯å®ç°**:
   ```python
   # æ–°çš„åŒä»·æ ¼æ•°æ®åŠ è½½å™¨
   adj_df, real_df, price_mapping = load_dual_price_data(csv_path)

   # ä¿¡å·è®¡ç®—åŸºäºå¤æƒä»·æ ¼çš„å‡çº¿
   bt = Backtest(adj_df, strategy_class)

   # äº¤æ˜“æ‰§è¡Œä½¿ç”¨åŸå§‹ä»·æ ¼
   result['price'] = price_mapping['latest_real_price']  # ç”¨äºå®é™…ä¸‹å•
   result['adj_price'] = price_mapping['latest_adj_price']  # ç”¨äºä¿¡å·å¼ºåº¦
   ```

3. **ä»·æ ¼å·®å¼‚ç¤ºä¾‹**:
   ```
   588170.SHï¼ˆç§‘åˆ›åŠå¯¼ä½“ETFï¼‰- 2025-11-03:
   å¤æƒä»·æ ¼: Â¥2.10 (ç”¨äºä¿¡å·è®¡ç®—)
   åŸå§‹ä»·æ ¼: Â¥1.39 (ç”¨äºå®é™…äº¤æ˜“)
   å·®å¼‚: 51%

   ä¿®å¤å‰: ç³»ç»Ÿé”™è¯¯åœ°å»ºè®®æŒ‰Â¥2.10ä¸‹å•
   ä¿®å¤å: ç³»ç»Ÿæ­£ç¡®åœ°å»ºè®®æŒ‰Â¥1.39ä¸‹å• âœ…
   ```

4. **é»˜è®¤è¡Œä¸º**:
   - **åŒä»·æ ¼æ¨¡å¼ç°åœ¨æ˜¯é»˜è®¤å¯ç”¨çš„**
   - å¦‚éœ€å›é€€åˆ°æ—§æ¨¡å¼ï¼Œå¯ä½¿ç”¨ `--disable-dual-price` å‚æ•°ï¼ˆä¸æ¨èï¼‰
   - å…¼å®¹æ‰€æœ‰ç°æœ‰åŠŸèƒ½ï¼ˆæ— çŠ¶æ€æ¨¡å¼ã€æŒä»“ç®¡ç†æ¨¡å¼ï¼‰

5. **éªŒè¯ç»“æœ**:
   ```bash
   # ä¿®å¤å‰çš„é—®é¢˜
   ./generate_daily_signals.sh --stock-list pool.csv
   # è¾“å‡º: ä¹°å…¥ä»·æ ¼: Â¥2.10 (é”™è¯¯çš„å¤æƒä»·æ ¼)

   # ä¿®å¤å
   ./generate_daily_signals.sh --stock-list pool.csv
   # è¾“å‡º: ä¹°å…¥ä»·æ ¼: Â¥1.39 (æ­£ç¡®çš„åŸå§‹ä»·æ ¼) âœ…
   ```

**ç»“è®º**:
- âœ… é—®é¢˜å·²å½»åº•è§£å†³
- âœ… ä¿¡å·é€»è¾‘æ­£ç¡®ï¼ˆåŸºäºå¤æƒä»·æ ¼ï¼‰
- âœ… äº¤æ˜“ä»·æ ¼æ­£ç¡®ï¼ˆåŸºäºåŸå§‹ä»·æ ¼ï¼‰
- âœ… å®Œå…¨å…¼å®¹ç°æœ‰æµç¨‹
- âš ï¸ **æ‰§è¡Œæ¨¡å¼ç°åœ¨å¯ä»¥å®‰å…¨ç”¨äºå®ç›˜**

---

## æ”¯æŒä¸åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æŸ¥çœ‹ï¼š
- é¡¹ç›®æ–‡æ¡£ï¼š`README_BACKTESTING.md`
- å›æµ‹æ–‡æ¡£ï¼š`README_BACKTESTING.md`
- ETFç­›é€‰æ–‡æ¡£ï¼š`etf_selector/README.md`
